

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>csep.utils.plots &mdash; pyCSEP v0.7.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=05c9169f"></script>
      <script src="../../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <!-- Google Analytics -->
    <!-- added options to anonymize ip and disable cookies using {'storage': 'none'} 
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-495056-15', 'auto', {'storage': 'none'});
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
    </script> -->

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            pyCSEP
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/installing.html">Installing pyCSEP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/core_concepts.html">Core Concepts for Beginners</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/theory.html">Theory of CSEP Tests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials and Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/catalog_filtering.html">Catalogs operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/plot_gridded_forecast.html">Plotting gridded forecast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/gridded_forecast_evaluation.html">Grid-based Forecast Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/quadtree_gridded_forecast_evaluation.html">Quadtree Grid-based Forecast Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/working_with_catalog_forecasts.html">Working with catalog-based forecasts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/catalog_forecast_evaluation.html">Catalog-based Forecast Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/plot_customizations.html">Plot customizations</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/catalogs.html">Catalogs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/forecasts.html">Forecasts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/evaluations.html">Evaluations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../concepts/regions.html">Regions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Help &amp; Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/glossary.html">Terms and Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/publications.html">Referenced Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/roadmap.html">Development Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/developer_notes.html">Developer Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/api_reference.html">API Reference</a></li>
</ul>


    
        <p class="caption">
            <span class="caption-text">Source code and contributing</span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://github.com/SCECCode/pycsep/issues">Getting help</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/SCECcode/pycsep/blob/master/CHANGELOG.md">Change log</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/SCECcode/pycsep/blob/master/CONTRIBUTING.md">Contributing</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/SCECcode/pycsep/blob/master/CODE_OF_CONDUCT.md">Code of Conduct</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/SCECcode/pycsep/blob/master/LICENSE">License</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/SCECCode/pycsep">Source Code</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">pyCSEP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../csep.html">csep</a></li>
      <li class="breadcrumb-item active">csep.utils.plots</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for csep.utils.plots</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>

<span class="c1"># Third-party imports</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">string</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pandas</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">cumulative_trapezoid</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.lines</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">PatchCollection</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pyplot</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cartopy.mpl.gridliner</span><span class="w"> </span><span class="kn">import</span> <span class="n">LONGITUDE_FORMATTER</span><span class="p">,</span> <span class="n">LATITUDE_FORMATTER</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cartopy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">img_tiles</span>
<span class="c1"># PyCSEP imports</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">csep.utils.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">SECONDS_PER_DAY</span><span class="p">,</span> <span class="n">CSEP_MW_BINS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">csep.utils.calc</span><span class="w"> </span><span class="kn">import</span> <span class="n">bin1d_vec</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">csep.utils.time_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime_to_utc_epoch</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains plotting routines that generate figures for the stochastic</span>
<span class="sd">event sets produced from CSEP2 experiments and Poisson based CSEP1 experiments.</span>

<span class="sd">Right now functions dont have consistent signatures, which will be addressed in</span>
<span class="sd">future releases. That means that some functions might have more functionality </span>
<span class="sd">than others while the routines are being developed.</span>

<span class="sd">TODO: Add annotations for other two plots.</span>
<span class="sd">TODO: Add ability to plot annotations from multiple catalogs. </span>
<span class="sd">        Esp, for plot_histogram()</span>
<span class="sd">IDEA: Same concept mentioned in evaluations might apply here. The plots could </span>
<span class="sd">      be a common class that might provide more control to the end user.</span>
<span class="sd">IDEA: Since plotting functions are usable by these classes only that don&#39;t </span>
<span class="sd">      implement iter routines, maybe make them a class method. like </span>
<span class="sd">      data.plot_thing()</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_cumulative_events_versus_time_dev</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span>
                                           <span class="n">plot_args</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>


<span class="sd">    Args:</span>
<span class="sd">        xdata (ndarray): time bins for plotting shape (N,)</span>
<span class="sd">        ydata (ndarray or list like): ydata for plotting; shape (N,5) in order 2.5%Per, 25%Per, 50%Per, 75%Per, 97.5%Per</span>
<span class="sd">        obs_data (ndarry): same shape as xdata</span>
<span class="sd">        plot_args:</span>
<span class="sd">        show:</span>

<span class="sd">    Returns:</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">sim_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sim_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulated&#39;</span><span class="p">)</span>
    <span class="n">obs_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;obs_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Observation&#39;</span><span class="p">)</span>
    <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Cumulative Event Counts&#39;</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Days&#39;</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fifth_per</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">first_quar</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">med_counts</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">second_quar</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">nine_fifth</span> <span class="o">=</span> <span class="n">ydata</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;ydata must be a [N,5] ndarray.&quot;</span><span class="p">)</span>
    <span class="c1"># plotting</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">obs_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">med_counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sim_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">fifth_per</span><span class="p">,</span> <span class="n">nine_fifth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;5</span><span class="si">%-95%</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xdata</span><span class="p">,</span> <span class="n">first_quar</span><span class="p">,</span> <span class="n">second_quar</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;25</span><span class="si">%-75%</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative event count&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="c1"># pyplot.subplots_adjust(right=0.75)</span>
    <span class="c1"># annotate the plot with information from data</span>
    <span class="c1"># ax.annotate(str(observation), xycoords=&#39;axes fraction&#39;, xy=xycoords, fontsize=10, annotation_clip=False)</span>
    <span class="c1"># save figure</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="c1"># optionally show figure</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span>


<div class="viewcode-block" id="plot_cumulative_events_versus_time">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_cumulative_events_versus_time.html#csep.utils.plots.plot_cumulative_events_versus_time">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_cumulative_events_versus_time</span><span class="p">(</span><span class="n">stochastic_event_sets</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span>
                                       <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Same as below but performs the statistics on numpy arrays without using pandas data frames.</span>

<span class="sd">    Args:</span>
<span class="sd">        stochastic_event_sets:</span>
<span class="sd">        observation:</span>
<span class="sd">        show:</span>
<span class="sd">        plot_args:</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax: matplotlib.Axes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting cumulative event counts.&#39;</span><span class="p">)</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="c1"># get global information from stochastic event set</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">n_cat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stochastic_event_sets</span><span class="p">)</span>

    <span class="n">extreme_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ses</span> <span class="ow">in</span> <span class="n">stochastic_event_sets</span><span class="p">:</span>
        <span class="n">start_epoch</span> <span class="o">=</span> <span class="n">datetime_to_utc_epoch</span><span class="p">(</span><span class="n">ses</span><span class="o">.</span><span class="n">start_time</span><span class="p">)</span>
        <span class="n">end_epoch</span> <span class="o">=</span> <span class="n">datetime_to_utc_epoch</span><span class="p">(</span><span class="n">ses</span><span class="o">.</span><span class="n">end_time</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_epoch</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">end_epoch</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">extreme_times</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_epoch</span><span class="p">,</span> <span class="n">end_epoch</span><span class="p">))</span>

    <span class="c1"># offsets to start at 0 time and converts from millis to hours</span>
    <span class="n">time_bins</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">extreme_times</span><span class="p">),</span>
                                   <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">extreme_times</span><span class="p">),</span> <span class="mi">100</span><span class="p">,</span>
                                   <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retstep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">n_bins</span> <span class="o">=</span> <span class="n">time_bins</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">binned_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_cat</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ses</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stochastic_event_sets</span><span class="p">):</span>
        <span class="n">n_events</span> <span class="o">=</span> <span class="n">ses</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ses_origin_time</span> <span class="o">=</span> <span class="n">ses</span><span class="o">.</span><span class="n">get_epoch_times</span><span class="p">()</span>
        <span class="n">inds</span> <span class="o">=</span> <span class="n">bin1d_vec</span><span class="p">(</span><span class="n">ses_origin_time</span><span class="p">,</span> <span class="n">time_bins</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_events</span><span class="p">):</span>
            <span class="n">binned_counts</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">inds</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">1500</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processed </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> catalogs in </span><span class="si">{</span><span class="n">t1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Collected binned counts in </span><span class="si">{</span><span class="n">t1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span><span class="si">}</span><span class="s1"> seconds.&#39;</span><span class="p">)</span>
    <span class="n">summed_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">binned_counts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># compute summary statistics for plotting</span>
    <span class="n">fifth_per</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">summed_counts</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">first_quar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">summed_counts</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">med_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">summed_counts</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">second_quar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">summed_counts</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">nine_fifth</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">summed_counts</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># compute median for comcat data</span>
    <span class="n">obs_binned_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_bins</span><span class="p">)</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="n">bin1d_vec</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">get_epoch_times</span><span class="p">(),</span> <span class="n">time_bins</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">observation</span><span class="o">.</span><span class="n">event_count</span><span class="p">):</span>
        <span class="n">obs_binned_counts</span><span class="p">[</span><span class="n">inds</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">obs_summed_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">obs_binned_counts</span><span class="p">)</span>

    <span class="c1"># update time_bins for plotting</span>
    <span class="n">millis_to_hours</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">24</span>
    <span class="n">time_bins</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_bins</span> <span class="o">-</span> <span class="n">time_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">millis_to_hours</span>
    <span class="n">time_bins</span> <span class="o">=</span> <span class="n">time_bins</span> <span class="o">+</span> <span class="p">(</span><span class="n">dt</span> <span class="o">/</span> <span class="n">millis_to_hours</span><span class="p">)</span>
    <span class="c1"># make all arrays start at zero</span>
    <span class="n">time_bins</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">time_bins</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">fifth_per</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">fifth_per</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">first_quar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">first_quar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">med_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">med_counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">second_quar</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">second_quar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">nine_fifth</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">nine_fifth</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">obs_summed_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">obs_summed_counts</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># get values from plotting args</span>
    <span class="n">sim_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sim_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulated&#39;</span><span class="p">)</span>
    <span class="n">obs_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;obs_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Observation&#39;</span><span class="p">)</span>
    <span class="n">xycoords</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xycoords&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.00</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">))</span>
    <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Cumulative Event Counts&#39;</span><span class="p">)</span>
    <span class="c1"># plotting</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_bins</span><span class="p">,</span> <span class="n">obs_summed_counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">obs_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_bins</span><span class="p">,</span> <span class="n">med_counts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sim_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">time_bins</span><span class="p">,</span> <span class="n">fifth_per</span><span class="p">,</span> <span class="n">nine_fifth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;5</span><span class="si">%-95%</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">time_bins</span><span class="p">,</span> <span class="n">first_quar</span><span class="p">,</span> <span class="n">second_quar</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;25</span><span class="si">%-75%</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Days since Mainshock&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Event Count&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="c1"># annotate the plot with information from data</span>
    <span class="c1"># ax.annotate(str(observation), xycoords=&#39;axes fraction&#39;, xy=xycoords, fontsize=10, annotation_clip=False)</span>
    <span class="c1"># save figure</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="c1"># optionally show figure</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_magnitude_versus_time">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_magnitude_versus_time.html#csep.utils.plots.plot_magnitude_versus_time">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_magnitude_versus_time</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                               <span class="n">reset_times</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots magnitude versus linear time for an earthquake data.</span>

<span class="sd">    Catalog class must implement get_magnitudes() and get_datetimes() in order for this function to work correctly.</span>

<span class="sd">    Args:</span>
<span class="sd">        catalog (:class:`~csep.core.catalogs.AbstractBaseCatalog`): data to visualize</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): fig and axes handle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># get values from plotting args</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">marker_size</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker_size&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">clabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;clabel&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plotting magnitude versus time.&#39;</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

    <span class="c1"># get time in days</span>
    <span class="c1"># plotting timestamps for now, until I can format dates on axis properly</span>
    <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span> <span class="o">/</span> <span class="n">SECONDS_PER_DAY</span>

    <span class="c1"># map returns a generator function which we collapse with list</span>
    <span class="n">days_elapsed</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get_datetimes</span><span class="p">())))</span>

    <span class="k">if</span> <span class="n">reset_times</span><span class="p">:</span>
        <span class="n">days_elapsed</span> <span class="o">=</span> <span class="n">days_elapsed</span> <span class="o">-</span> <span class="n">days_elapsed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">magnitudes</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get_magnitudes</span><span class="p">()</span>

    <span class="c1"># make plot</span>
    <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">days_elapsed</span><span class="p">,</span> <span class="n">magnitudes</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">marker_size</span><span class="p">,</span>
                       <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;jet&#39;</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">clabel</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">days_elapsed</span><span class="p">,</span> <span class="n">magnitudes</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">marker_size</span><span class="p">,</span>
                   <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># do some labeling of the figure</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Days Elapsed&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Magnitude&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># # annotate the plot with information from data</span>
    <span class="c1"># if data is not None:</span>
    <span class="c1">#     try:</span>
    <span class="c1">#         ax.annotate(str(data), xycoords=&#39;axes fraction&#39;, xy=xycoords, fontsize=10, annotation_clip=False)</span>
    <span class="c1">#     except:</span>
    <span class="c1">#         pass</span>

    <span class="c1"># handle displaying of figures</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_histogram">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_histogram.html#csep.utils.plots.plot_histogram">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_histogram</span><span class="p">(</span><span class="n">simulated</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="s1">&#39;fd&#39;</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">catalog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots histogram of single statistic for stochastic event sets and observations. The function will behave differently</span>
<span class="sd">    depending on the inumpyuts.</span>

<span class="sd">    Simulated should always be either a list or numpy.array where there would be one value per data in the stochastic event</span>
<span class="sd">    set. Observation could either be a scalar or a numpy.array/list. If observation is a scale a vertical line would be</span>
<span class="sd">    plotted, if observation is iterable a second histogram would be plotted.</span>

<span class="sd">    This allows for comparisons to be made against catalogs where there are multiple values e.g., magnitude, and single values</span>
<span class="sd">    e.g., event count.</span>

<span class="sd">    If an axis handle is included, additional function calls will only addition extra simulations, observations will not be</span>
<span class="sd">    plotted. Since this function returns an axes handle, any extra modifications to the figure can be made using that.</span>

<span class="sd">    Args:</span>
<span class="sd">        simulated (numpy.arrays): numpy.array like representation of statistics computed from catalogs.</span>
<span class="sd">        observation(numpy.array or scalar): observation to plot against stochastic event set</span>
<span class="sd">        filename (str): filename to save figure</span>
<span class="sd">        show (bool): show interactive version of the figure</span>
<span class="sd">        ax (axis object): axis object with interface defined by matplotlib</span>
<span class="sd">        catalog (csep.AbstractBaseCatalog): used for annotating the figures</span>
<span class="sd">        plot_args (dict): additional plotting commands. TODO: Documentation</span>

<span class="sd">    Returns:</span>
<span class="sd">        axis: matplolib axes handle</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Plotting</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">chained</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">catalog</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="c1"># parse plotting arguments</span>
    <span class="n">sim_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sim_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulated&#39;</span><span class="p">)</span>
    <span class="n">obs_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;obs_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Observation&#39;</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
    <span class="n">xycoords</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xycoords&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.00</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">))</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlim&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># this could throw an error exposing bad implementation</span>
    <span class="n">observation</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">observation</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                   <span class="n">label</span><span class="o">=</span><span class="n">obs_label</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># remove any nan values</span>
        <span class="n">observation</span> <span class="o">=</span> <span class="n">observation</span><span class="p">[</span><span class="o">~</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">observation</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">obs_label</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># remove any potential nans from arrays</span>
    <span class="n">simulated</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">simulated</span><span class="p">)</span>
    <span class="n">simulated</span> <span class="o">=</span> <span class="n">simulated</span><span class="p">[</span><span class="o">~</span><span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">simulated</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">color</span><span class="p">:</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">simulated</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sim_label</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                        <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">simulated</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sim_label</span><span class="p">,</span>
                                        <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># color bars for rejection area</span>
    <span class="k">if</span> <span class="n">percentile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">percentile</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">inc_high</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">inc</span>
        <span class="n">inc_low</span> <span class="o">=</span> <span class="n">inc</span>
        <span class="n">p_high</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">simulated</span><span class="p">,</span> <span class="n">inc_high</span><span class="p">)</span>
        <span class="n">idx_high</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">p_high</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">)</span>
        <span class="n">p_low</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">simulated</span><span class="p">,</span> <span class="n">inc_low</span><span class="p">)</span>
        <span class="n">idx_low</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">p_low</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">)</span>

    <span class="c1"># show 99.5% of data</span>
    <span class="k">if</span> <span class="n">xlim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">upper_xlim</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">simulated</span><span class="p">,</span> <span class="mf">99.75</span><span class="p">)</span>
        <span class="n">upper_xlim</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">upper_xlim</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">observation</span><span class="p">)])</span>
        <span class="n">d_bin</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">upper_xlim</span> <span class="o">=</span> <span class="n">upper_xlim</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">d_bin</span>

        <span class="n">lower_xlim</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">simulated</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
        <span class="n">lower_xlim</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">lower_xlim</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">observation</span><span class="p">)])</span>
        <span class="n">lower_xlim</span> <span class="o">=</span> <span class="n">lower_xlim</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">d_bin</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">lower_xlim</span><span class="p">,</span> <span class="n">upper_xlim</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ignoring observation in axis scaling because inf or -inf&#39;</span><span class="p">)</span>
            <span class="n">upper_xlim</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">simulated</span><span class="p">,</span> <span class="mf">99.75</span><span class="p">)</span>
            <span class="n">upper_xlim</span> <span class="o">=</span> <span class="n">upper_xlim</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">d_bin</span>

            <span class="n">lower_xlim</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">simulated</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
            <span class="n">lower_xlim</span> <span class="o">=</span> <span class="n">lower_xlim</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">d_bin</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">lower_xlim</span><span class="p">,</span> <span class="n">upper_xlim</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">)</span>

    <span class="c1"># hacky workaround for coloring legend, by calling after legend is drawn.</span>
    <span class="k">if</span> <span class="n">percentile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_low</span><span class="p">):</span>
            <span class="n">patches</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_fc</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_high</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">patches</span><span class="p">)):</span>
            <span class="n">patches</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">set_fc</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_ecdf">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_ecdf.html#csep.utils.plots.plot_ecdf">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_ecdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ecdf</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plots empirical cumulative distribution function.  &quot;&quot;&quot;</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="c1"># get values from plotting args</span>
    <span class="n">sim_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sim_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulated&#39;</span><span class="p">)</span>
    <span class="n">obs_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;obs_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Observation&#39;</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;$P(X \leq x)$&#39;</span><span class="p">)</span>
    <span class="n">xycoords</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xycoords&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.00</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">))</span>
    <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># make figure</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">figure</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ecdf</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sim_label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xv</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xv</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">obs_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">)</span>

    <span class="c1"># if data is not None:</span>
    <span class="c1">#     ax.annotate(str(data), xycoords=&#39;axes fraction&#39;, xy=xycoords, fontsize=10, annotation_clip=False)</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">plot_magnitude_histogram_dev</span><span class="p">(</span><span class="n">ses_data</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">plot_args</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">bin_edges</span><span class="p">,</span> <span class="n">obs_hist</span> <span class="o">=</span> <span class="n">obs</span><span class="o">.</span><span class="n">magnitude_counts</span><span class="p">(</span><span class="n">retbins</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">n_obs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">obs_hist</span><span class="p">)</span>
    <span class="n">event_counts</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ses_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># normalize all histograms by counts in each</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">n_obs</span> <span class="o">/</span> <span class="n">event_counts</span>
    <span class="c1"># use broadcasting</span>
    <span class="n">ses_data</span> <span class="o">=</span> <span class="n">ses_data</span> <span class="o">*</span> <span class="n">scale</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">u3etas_median</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">ses_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">u3etas_low</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">ses_data</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">u3etas_high</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">ses_data</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">u3etas_min</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ses_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">u3etas_max</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ses_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">u3etas_emax</span> <span class="o">=</span> <span class="n">u3etas_max</span> <span class="o">-</span> <span class="n">u3etas_median</span>
    <span class="n">u3etas_emin</span> <span class="o">=</span> <span class="n">u3etas_median</span> <span class="o">-</span> <span class="n">u3etas_min</span>
    <span class="n">dmw</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bin_edges_plot</span> <span class="o">=</span> <span class="n">bin_edges</span> <span class="o">+</span> <span class="n">dmw</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># u3etas_emax = u3etas_max</span>
    <span class="c1"># plot 95% range as rectangles</span>
    <span class="n">rectangles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">)):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">dmw</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">u3etas_high</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">u3etas_low</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">u3etas_low</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">rectangles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PatchCollection</span><span class="p">(</span><span class="n">rectangles</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                                                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
    <span class="c1"># plot whiskers</span>
    <span class="n">sim_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sim_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulated Catalogs&#39;</span><span class="p">)</span>
    <span class="n">obs_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;obs_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Observed Catalog&#39;</span><span class="p">)</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlim&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s2">&quot;UCERF3-ETAS Histogram&quot;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">bin_edges_plot</span><span class="p">,</span> <span class="n">u3etas_median</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">u3etas_emin</span><span class="p">,</span> <span class="n">u3etas_emax</span><span class="p">],</span>
                <span class="n">xerr</span><span class="o">=</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">dmw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sim_label</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_edges_plot</span><span class="p">,</span> <span class="n">obs_hist</span><span class="p">,</span> <span class="s1">&#39;.k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">obs_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Magnitude&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Event count per magnitude bin&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="c1"># ax.annotate(str(comcat), xycoords=&#39;axes fraction&#39;, xy=xycoords, fontsize=10, annotation_clip=False)</span>
    <span class="c1"># pyplot.subplots_adjust(right=0.75)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>


<div class="viewcode-block" id="plot_magnitude_histogram">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_magnitude_histogram.html#csep.utils.plots.plot_magnitude_histogram">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_magnitude_histogram</span><span class="p">(</span><span class="n">catalogs</span><span class="p">,</span> <span class="n">comcat</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Generates a magnitude histogram from a catalog-based forecast &quot;&quot;&quot;</span>
    <span class="c1"># get list of magnitudes list of ndarray</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">catalogs_mws</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_magnitudes</span><span class="p">(),</span> <span class="n">catalogs</span><span class="p">))</span>
    <span class="n">obs_mw</span> <span class="o">=</span> <span class="n">comcat</span><span class="o">.</span><span class="n">get_magnitudes</span><span class="p">()</span>
    <span class="n">n_obs</span> <span class="o">=</span> <span class="n">comcat</span><span class="o">.</span><span class="n">get_number_of_events</span><span class="p">()</span>

    <span class="c1"># get histogram at arbitrary values</span>
    <span class="n">mws</span> <span class="o">=</span> <span class="n">CSEP_MW_BINS</span>
    <span class="n">dmw</span> <span class="o">=</span> <span class="n">mws</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">mws</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mws</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">n_temp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">normed</span> <span class="ow">and</span> <span class="n">n_temp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">temp_scale</span> <span class="o">=</span> <span class="n">n_obs</span> <span class="o">/</span> <span class="n">n_temp</span>
            <span class="n">hist</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">mws</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">temp_scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hist</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">mws</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">hist</span>

    <span class="c1"># get hist values</span>
    <span class="n">u3etas_hist</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_hist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mws</span><span class="p">),</span> <span class="n">catalogs_mws</span><span class="p">)))</span>
    <span class="n">obs_hist</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">obs_mw</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">mws</span><span class="p">)</span>
    <span class="n">bin_edges_plot</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">u3etas_median</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">u3etas_hist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">u3etas_low</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">u3etas_hist</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">u3etas_high</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">u3etas_hist</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">u3etas_min</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">u3etas_hist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">u3etas_max</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u3etas_hist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">u3etas_emax</span> <span class="o">=</span> <span class="n">u3etas_max</span> <span class="o">-</span> <span class="n">u3etas_median</span>
    <span class="n">u3etas_emin</span> <span class="o">=</span> <span class="n">u3etas_median</span> <span class="o">-</span> <span class="n">u3etas_min</span>

    <span class="c1"># u3etas_emax = u3etas_max</span>
    <span class="c1"># plot 95% range as rectangles</span>
    <span class="n">rectangles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mws</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">dmw</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">u3etas_high</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">u3etas_low</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">xi</span> <span class="o">=</span> <span class="n">mws</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">yi</span> <span class="o">=</span> <span class="n">u3etas_low</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">rect</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">rectangles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
    <span class="n">pc</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">PatchCollection</span><span class="p">(</span><span class="n">rectangles</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                                                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">pc</span><span class="p">)</span>
    <span class="c1"># plot whiskers</span>
    <span class="n">sim_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sim_label&#39;</span><span class="p">,</span> <span class="s1">&#39;Simulated Catalogs&#39;</span><span class="p">)</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlim&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s2">&quot;UCERF3-ETAS Histogram&quot;</span><span class="p">)</span>
    <span class="n">xycoords</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xycoords&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.00</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">))</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">pyplot</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">bin_edges_plot</span><span class="p">,</span> <span class="n">u3etas_median</span><span class="p">,</span>
                    <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">u3etas_emin</span><span class="p">,</span> <span class="n">u3etas_emax</span><span class="p">],</span> <span class="n">xerr</span><span class="o">=</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">dmw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">sim_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bin_edges_plot</span><span class="p">,</span> <span class="n">obs_hist</span><span class="p">,</span> <span class="s1">&#39;.k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Comcat&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Mw&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="c1"># ax.annotate(str(comcat), xycoords=&#39;axes fraction&#39;, xy=xycoords, fontsize=10, annotation_clip=False)</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_basemap">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_basemap.html#csep.utils.plots.plot_basemap">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_basemap</span><span class="p">(</span><span class="n">basemap</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coastline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">borders</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tile_scaling</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                 <span class="n">set_global</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">apprx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                 <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Wrapper function for multiple cartopy base plots, including access to standard raster webservices</span>

<span class="sd">     Args:</span>
<span class="sd">         basemap (str): Possible values are: stock_img, stamen_terrain, stamen_terrain-background, google-satellite, ESRI_terrain, ESRI_imagery, ESRI_relief, ESRI_topo, ESRI_terrain, or webservice link (see examples in :func:`csep.utils.plots._get_basemap`. Default is None</span>
<span class="sd">         extent (list):  [lon_min, lon_max, lat_min, lat_max]</span>
<span class="sd">         ax (:class:`matplotlib.pyplot.ax`): Previously defined ax object</span>
<span class="sd">         figsize (tuple): If no ax is provided, a tuple of floats can be provided to define figure size</span>
<span class="sd">         coastline (str): Flag to plot coastline. default True,</span>
<span class="sd">         borders (bool): Flag to plot country borders. default False,</span>
<span class="sd">         tile_scaling (str/int): Zoom level (1-12) of the basemap tiles. If &#39;auto&#39;, is automatically derived from extent</span>
<span class="sd">         set_global (bool): Display the complete globe as basemap</span>
<span class="sd">         projection (:class:`cartopy.crs.Projection`): Projection to be used in the basemap</span>
<span class="sd">         apprx (bool): If true, approximates transformation by setting aspect ratio of axes based on middle latitude</span>
<span class="sd">         central_latitude (float): average latitude from plotting region</span>
<span class="sd">         linecolor (str): Color of borders and coast lines. default &#39;black&#39;,</span>
<span class="sd">         linewidth (float): Line width of borders and coast lines. default 1.5,</span>
<span class="sd">         grid (bool): Draws a grid in the basemap</span>
<span class="sd">         grid_labels (bool): Annotate grid values</span>
<span class="sd">         grid_fontsize (float): Font size of the grid x and y labels</span>
<span class="sd">         show (bool): Flag if the figure is displayed</span>

<span class="sd">     Returns:</span>
<span class="sd">         :class:`matplotlib.pyplot.ax` object</span>

<span class="sd">     &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">apprx</span><span class="p">:</span>
            <span class="n">projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
            <span class="c1"># Set plot aspect according to local longitude-latitude ratio in metric units</span>
            <span class="c1"># (only compatible with plain PlateCarree &quot;projection&quot;)</span>
            <span class="n">LATKM</span> <span class="o">=</span> <span class="mf">110.574</span>  <span class="c1"># length of a ° of latitude [km]; constant --&gt; ignores Earth&#39;s flattening</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span>
                <span class="n">LATKM</span> <span class="o">/</span> <span class="p">(</span><span class="mf">111.320</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">central_latitude</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">set_global</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extents</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Set adaptive scaling</span>
        <span class="n">line_autoscaler</span> <span class="o">=</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">AdaptiveScaler</span><span class="p">(</span><span class="s1">&#39;110m&#39;</span><span class="p">,</span> <span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;50m&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>
        <span class="n">tile_autoscaler</span> <span class="o">=</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">AdaptiveScaler</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">15</span><span class="p">)))</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Set tile depth</span>
        <span class="k">if</span> <span class="n">tile_scaling</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
            <span class="n">tile_depth</span> <span class="o">=</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">set_global</span> <span class="k">else</span> <span class="n">tile_autoscaler</span><span class="o">.</span><span class="n">scale_from_extent</span><span class="p">(</span>
                <span class="n">extent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tile_depth</span> <span class="o">=</span> <span class="n">tile_scaling</span>
        <span class="k">if</span> <span class="n">coastline</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">borders</span><span class="p">:</span>
            <span class="n">borders</span> <span class="o">=</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">feature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span><span class="s1">&#39;cultural&#39;</span><span class="p">,</span>
                                                          <span class="s1">&#39;admin_0_boundary_lines_land&#39;</span><span class="p">,</span>
                                                          <span class="n">line_autoscaler</span><span class="p">,</span>
                                                          <span class="n">edgecolor</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span>
                                                          <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;never&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">borders</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">basemap</span> <span class="o">==</span> <span class="s1">&#39;stock_img&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">stock_img</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">basemap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tiles</span> <span class="o">=</span> <span class="n">_get_basemap</span><span class="p">(</span><span class="n">basemap</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tiles</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_image</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">tile_depth</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Unable to plot basemap. This might be due to no internet access, try pre-downloading the files.&quot;</span><span class="p">)</span>

    <span class="c1"># Gridline options</span>
    <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="n">grid_labels</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_fontsize</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_fontsize</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_catalog">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_catalog.html#csep.utils.plots.plot_catalog">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_catalog</span><span class="p">(</span><span class="n">catalog</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">set_global</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plot catalog in a region</span>

<span class="sd">    Args:</span>
<span class="sd">        catalog (:class:`CSEPCatalog`): Catalog object to be plotted</span>
<span class="sd">        ax (:class:`matplotlib.pyplot.ax`): Previously defined ax object (e.g from plot_spatial_dataset)</span>
<span class="sd">        show (bool): Flag if the figure is displayed</span>
<span class="sd">        extent (list):  default 1.05-:func:`catalog.region.get_bbox()`</span>
<span class="sd">        set_global (bool): Display the complete globe as basemap</span>
<span class="sd">        plot_args (dict): matplotlib and cartopy plot arguments. The dictionary keys are str, whose items can be:</span>

<span class="sd">           - :figsize: :class:`tuple`/:class:`list` - default [6.4, 4.8]</span>
<span class="sd">           - :title: :class:`str` - default :class:`catalog.name`</span>
<span class="sd">           - :title_size: :class:`int` - default 10</span>
<span class="sd">           - :filename: :class:`str` - File to save figure. default None</span>
<span class="sd">           - :projection: :class:`cartopy.crs.Projection` - default :class:`cartopy.crs.PlateCarree`. Note: this can be</span>
<span class="sd">                &#39;fast&#39; to apply an approximate transformation of axes.</span>
<span class="sd">           - :basemap:  :class:`str`/:class:`None`. Possible values are: stock_img, stamen_terrain, stamen_terrain-background, google-satellite, ESRI_terrain, ESRI_imagery, ESRI_relief, ESRI_topo, ESRI_terrain, or webservice link. Default is None</span>
<span class="sd">           - :coastline: :class:`bool` - Flag to plot coastline. default True,</span>
<span class="sd">           - :grid: :class:`bool` - default True</span>
<span class="sd">           - :grid_labels: :class:`bool` - default True</span>
<span class="sd">           - :grid_fontsize: :class:`float` - default 10.0</span>
<span class="sd">           - :marker: :class:`str` - Marker type</span>
<span class="sd">           - :markersize: :class:`float` - Constant size for all earthquakes</span>
<span class="sd">           - :markercolor: :class:`str` - Color for all earthquakes</span>
<span class="sd">           - :borders: :class:`bool` - Flag to plot country borders. default False,</span>
<span class="sd">           - :region_border: :class:`bool` - Flag to plot the catalog region border. default True,</span>
<span class="sd">           - :alpha: :class:`float` - Transparency for the earthquakes scatter</span>
<span class="sd">           - :mag_scale: :class:`float` - Scaling of the scatter</span>
<span class="sd">           - :legend: :class:`bool` - Flag to display the legend box</span>
<span class="sd">           - :legend_loc: :class:`int`/:class:`str` - Position of the legend</span>
<span class="sd">           - :mag_ticks: :class:`list` - Ticks to display in the legend</span>
<span class="sd">           - :labelspacing: :class:`int` - Separation between legend ticks</span>
<span class="sd">           - :tile_scaling: :class:`str`/:class:`int`. Zoom level (1-12) of the basemap tiles. If &#39;auto&#39;, is automatically derived from extent</span>
<span class="sd">           - :linewidth: :class:`float` - Line width of borders and coast lines. default 1.5,</span>
<span class="sd">           - :linecolor: :class:`str` - Color of borders and coast lines. default &#39;black&#39;,</span>

<span class="sd">    Returns:</span>
<span class="sd">        :class:`matplotlib.pyplot.ax` object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get spatial information for plotting</span>

    <span class="c1"># Retrieve plot arguments</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="c1"># figure and axes properties</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">catalog</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">title_size</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_size&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># scatter properties</span>
    <span class="n">markersize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">markercolor</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;markercolor&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">markeredgecolor</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;markeredgecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">mag_scale</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mag_scale&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">legend_title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_title&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;Magnitudes&quot;</span><span class="p">)</span>
    <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">legend_framealpha</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_framealpha&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">legend_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">legend_titlesize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_titlesize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">mag_ticks</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mag_ticks&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">labelspacing</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;labelspacing&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">region_border</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region_border&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">legend_borderpad</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_borderpad&#39;</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
    <span class="c1"># cartopy properties</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;projection&#39;</span><span class="p">,</span>
                               <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="n">basemap</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;basemap&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">coastline</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;coastline&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">grid_labels</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grid_labels&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">grid_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grid_fontsize&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">borders</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;borders&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">tile_scaling</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tile_scaling&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">linecolor</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>

    <span class="n">bbox</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">region_border</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">extent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">set_global</span><span class="p">:</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">20.</span>
        <span class="n">dv</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">20.</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dh</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dh</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">dv</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">dv</span><span class="p">]</span>

    <span class="n">apprx</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">central_latitude</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;fast&#39;</span><span class="p">:</span>
        <span class="n">projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
        <span class="n">apprx</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">n_lats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">ys</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">central_latitude</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">ys</span><span class="p">[</span><span class="n">n_lats</span><span class="p">]</span>

    <span class="c1"># Instantiage GeoAxes object</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">set_global</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
        <span class="n">region_border</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extents</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                      <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>  <span class="c1"># Defined extent always in lat/lon</span>

    <span class="c1"># Basemap plotting</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_basemap</span><span class="p">(</span><span class="n">basemap</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">coastline</span><span class="o">=</span><span class="n">coastline</span><span class="p">,</span>
                      <span class="n">borders</span><span class="o">=</span><span class="n">borders</span><span class="p">,</span> <span class="n">tile_scaling</span><span class="o">=</span><span class="n">tile_scaling</span><span class="p">,</span>
                      <span class="n">linecolor</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                      <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">apprx</span><span class="o">=</span><span class="n">apprx</span><span class="p">,</span>
                      <span class="n">central_latitude</span><span class="o">=</span><span class="n">central_latitude</span><span class="p">,</span> <span class="n">set_global</span><span class="o">=</span><span class="n">set_global</span><span class="p">)</span>

    <span class="c1"># Scaling function</span>
    <span class="n">mw_range</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">get_magnitudes</span><span class="p">()),</span> <span class="nb">max</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">get_magnitudes</span><span class="p">())]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">size_map</span><span class="p">(</span><span class="n">markersize</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mag_scale</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">markersize</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale</span> <span class="o">**</span> <span class="n">mw_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">values</span><span class="p">,</span>
                                                                      <span class="n">scale</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;scale data type not supported&#39;</span><span class="p">)</span>

    <span class="c1">## Plot catalog</span>
    <span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">catalog</span><span class="o">.</span><span class="n">get_longitudes</span><span class="p">(),</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get_latitudes</span><span class="p">(),</span>
                         <span class="n">s</span><span class="o">=</span><span class="n">size_map</span><span class="p">(</span><span class="n">markersize</span><span class="p">,</span> <span class="n">catalog</span><span class="o">.</span><span class="n">get_magnitudes</span><span class="p">(),</span>
                                    <span class="n">mag_scale</span><span class="p">),</span>
                         <span class="n">transform</span><span class="o">=</span><span class="n">cartopy</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                         <span class="n">color</span><span class="o">=</span><span class="n">markercolor</span><span class="p">,</span>
                         <span class="n">edgecolors</span><span class="o">=</span><span class="n">markeredgecolor</span><span class="p">,</span>
                         <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="c1"># Legend</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mag_ticks</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">mw_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">mw_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                              <span class="n">mag_ticks</span><span class="p">]):</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Magnitude ticks do not lie within the catalog magnitude range&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mag_ticks</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">mag_ticks</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mw_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mw_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">scatter</span><span class="o">.</span><span class="n">legend_elements</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="s2">&quot;sizes&quot;</span><span class="p">,</span>
                                                  <span class="n">num</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">size_map</span><span class="p">(</span><span class="n">markersize</span><span class="p">,</span>
                                                                    <span class="n">mag_ticks</span><span class="p">,</span>
                                                                    <span class="n">mag_scale</span><span class="p">)),</span>
                                                  <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">mag_ticks</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                  <span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">legend_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">,</span>
                  <span class="n">title_fontsize</span><span class="o">=</span><span class="n">legend_titlesize</span><span class="p">,</span>
                  <span class="n">labelspacing</span><span class="o">=</span><span class="n">labelspacing</span><span class="p">,</span> <span class="n">handletextpad</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                  <span class="n">borderpad</span><span class="o">=</span><span class="n">legend_borderpad</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="n">legend_framealpha</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">region_border</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">tight_bbox</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c1"># print(&quot;unable to get tight bbox&quot;)</span>

    <span class="c1"># Gridline options</span>
    <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="n">grid_labels</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_fontsize</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_fontsize</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>

    <span class="c1"># Figure options</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_size</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.06</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_spatial_dataset">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_spatial_dataset.html#csep.utils.plots.plot_spatial_dataset">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_spatial_dataset</span><span class="p">(</span><span class="n">gridded</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">set_global</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plot spatial dataset such as data from a gridded forecast</span>

<span class="sd">    Args:</span>
<span class="sd">        gridded (2D :class:`numpy.array`): Values according to `region`,</span>
<span class="sd">        region (:class:`CartesianGrid2D`): Region in which gridded values are contained</span>
<span class="sd">        show (bool): Flag if the figure is displayed</span>
<span class="sd">        extent (list):  default :func:`forecast.region.get_bbox()`</span>
<span class="sd">        set_global (bool): Display the complete globe as basemap</span>
<span class="sd">        plot_args (dict): matplotlib and cartopy plot arguments. Dict keys are str, whose values can be:</span>

<span class="sd">           - :figsize: :class:`tuple`/:class:`list` - default [6.4, 4.8]</span>
<span class="sd">           - :title: :class:`str` - default None</span>
<span class="sd">           - :title_size: :class:`int` - default 10</span>
<span class="sd">           - :filename: :class:`str` - default None</span>
<span class="sd">           - :projection: :class:`cartopy.crs.Projection` - default :class:`cartopy.crs.PlateCarree`</span>
<span class="sd">           - :grid: :class:`bool` - default True</span>
<span class="sd">           - :grid_labels: :class:`bool` - default True</span>
<span class="sd">           - :grid_fontsize: :class:`float` - default 10.0</span>
<span class="sd">           - :basemap:  :class:`str`. Possible  values are: stock_img, stamen_terrain, stamen_terrain-background, google-satellite, ESRI_terrain, ESRI_imagery, ESRI_relief, ESRI_topo, ESRI_terrain, or webservice link. Default is None</span>
<span class="sd">           - :coastline: :class:`bool` - Flag to plot coastline. default True,</span>
<span class="sd">           - :borders: :class:`bool` - Flag to plot country borders. default False,</span>
<span class="sd">           - :region_border: :class:`bool` - Flag to plot the dataset region border. default True,</span>
<span class="sd">           - :tile_scaling: :class:`str`/:class:`int`. Zoom level (1-12) of the basemap tiles. If &#39;auto&#39;, is automatically derived from extent</span>
<span class="sd">           - :linewidth: :class:`float` - Line width of borders and coast lines. default 1.5,</span>
<span class="sd">           - :linecolor: :class:`str` - Color of borders and coast lines. default &#39;black&#39;,</span>
<span class="sd">           - :cmap: :class:`str`/:class:`pyplot.colors.Colormap` -  default &#39;viridis&#39;</span>
<span class="sd">           - :clim: :class:`list` - Range of the colorbar. default None</span>
<span class="sd">           - :clabel: :class:`str` - Label of the colorbar. default None</span>
<span class="sd">           - :clabel_fontsize: :class:`float` - default None</span>
<span class="sd">           - :cticks_fontsize: :class:`float` - default None</span>
<span class="sd">           - :alpha: :class:`float` - default 1</span>
<span class="sd">           - :alpha_exp: :class:`float` - Exponent for the alpha func (recommended between 0.4 and 1). default 0</span>


<span class="sd">    Returns:</span>
<span class="sd">        :class:`matplotlib.pyplot.ax` object</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get spatial information for plotting</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">get_bbox</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">extent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">set_global</span><span class="p">:</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">bbox</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>

    <span class="c1"># Retrieve plot arguments</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="c1"># figure and axes properties</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">title_size</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_size&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1"># cartopy properties</span>
    <span class="n">projection</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;projection&#39;</span><span class="p">,</span>
                               <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">grid_labels</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grid_labels&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">grid_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;grid_fontsize&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">basemap</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;basemap&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">coastline</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;coastline&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">borders</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;borders&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">tile_scaling</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tile_scaling&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">linecolor</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">region_border</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;region_border&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="c1"># color bar properties</span>
    <span class="n">include_cbar</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;include_cbar&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cmap&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">clim</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;clim&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">clabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;clabel&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">clabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;clabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">cticks_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cticks_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">alpha_exp</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;alpha_exp&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">apprx</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">central_latitude</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">projection</span> <span class="o">==</span> <span class="s1">&#39;fast&#39;</span><span class="p">:</span>
        <span class="n">projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
        <span class="n">apprx</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">n_lats</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">ys</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">central_latitude</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">ys</span><span class="p">[</span><span class="n">n_lats</span><span class="p">]</span>

    <span class="c1"># Instantiate GeoAxes object</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">set_global</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
        <span class="n">region_border</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extents</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span>
                      <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>  <span class="c1"># Defined extent always in lat/lon</span>

    <span class="c1"># Basemap plotting</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_basemap</span><span class="p">(</span><span class="n">basemap</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">coastline</span><span class="o">=</span><span class="n">coastline</span><span class="p">,</span>
                      <span class="n">borders</span><span class="o">=</span><span class="n">borders</span><span class="p">,</span>
                      <span class="n">linecolor</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                      <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">apprx</span><span class="o">=</span><span class="n">apprx</span><span class="p">,</span>
                      <span class="n">central_latitude</span><span class="o">=</span><span class="n">central_latitude</span><span class="p">,</span>
                      <span class="n">tile_scaling</span><span class="o">=</span><span class="n">tile_scaling</span><span class="p">,</span> <span class="n">set_global</span><span class="o">=</span><span class="n">set_global</span><span class="p">)</span>

    <span class="c1">## Define colormap and transparency function</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmap</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">cmap</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
    <span class="n">cmap_tup</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alpha_exp</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">alpha_exp</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cmap_tup</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha_exp</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">cmap_tup</span><span class="p">)</span>

    <span class="c1">## Plot spatial dataset</span>
    <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">xs</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">gridded</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">snap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="n">im</span><span class="o">.</span><span class="n">set_clim</span><span class="p">(</span><span class="n">clim</span><span class="p">)</span>

    <span class="c1"># Colorbar options</span>
    <span class="c1"># create an axes on the right side of ax. The width of cax will be 5%</span>
    <span class="c1"># of ax and the padding between cax and ax will be fixed at 0.05 inch.</span>
    <span class="k">if</span> <span class="n">include_cbar</span><span class="p">:</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span>
            <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">x1</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span>
             <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Colorbar&#39;</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">clabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">clabel_fontsize</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="n">cticks_fontsize</span><span class="p">)</span>

    <span class="c1"># Gridline options</span>
    <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
        <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="n">grid_labels</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_fontsize</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grid_fontsize</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">xformatter</span> <span class="o">=</span> <span class="n">LONGITUDE_FORMATTER</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">yformatter</span> <span class="o">=</span> <span class="n">LATITUDE_FORMATTER</span>

    <span class="k">if</span> <span class="n">region_border</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">tight_bbox</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pts</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pts</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># matplotlib figure options</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.06</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_number_test">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_number_test.html#csep.utils.plots.plot_number_test">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_number_test</span><span class="p">(</span><span class="n">evaluation_result</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes result from evaluation and generates a specific histogram plot to show the results of the statistical evaluation</span>
<span class="sd">    for the n-test.</span>

<span class="sd">    Args:</span>
<span class="sd">        evaluation_result: object-like var that implements the interface of the above EvaluationResult</span>
<span class="sd">        axes (matplotlib.Axes): axes object used to chain this plot</span>
<span class="sd">        show (bool): if true, call pyplot.show()</span>
<span class="sd">        plot_args(dict): optional argument containing a dictionary of plotting arguments, with keys as strings and items as described below</span>

<span class="sd">    Optional plotting arguments:</span>
<span class="sd">        * figsize: (:class:`list`/:class:`tuple`) - default: [6.4, 4.8]</span>
<span class="sd">        * title: (:class:`str`) - default: name of the first evaluation result type</span>
<span class="sd">        * title_fontsize: (:class:`float`) Fontsize of the plot title - default: 10</span>
<span class="sd">        * xlabel: (:class:`str`) - default: &#39;X&#39;</span>
<span class="sd">        * xlabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * xticks_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * ylabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * text_fontsize: (:class:`float`) - default: 14</span>
<span class="sd">        * tight_layout: (:class:`bool`) Set matplotlib.figure.tight_layout to remove excess blank space in the plot - default: True</span>
<span class="sd">        * percentile (:class:`float`) Critial region to shade on histogram - default: 95</span>
<span class="sd">        * bins: (:class:`str`) - Set binning type. see matplotlib.hist for more info - default: &#39;auto&#39;</span>
<span class="sd">        * xy: (:class:`list`/:class:`tuple`) - default: (0.55, 0.3)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax (matplotlib.axes.Axes): can be used to modify the figure</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># chain plotting axes if requested</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># default plotting arguments</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Number Test&#39;</span><span class="p">)</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Event count of catalogs&#39;</span><span class="p">)</span>
    <span class="n">xlabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of catalogs&#39;</span><span class="p">)</span>
    <span class="n">ylabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text_fontsize&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">tight_layout</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tight_layout&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">percentile</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>

    <span class="c1"># set default plotting arguments</span>
    <span class="n">fixed_plot_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;obs_label&#39;</span><span class="p">:</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">obs_name</span><span class="p">,</span>
                       <span class="s1">&#39;sim_label&#39;</span><span class="p">:</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">sim_name</span><span class="p">}</span>
    <span class="n">plot_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fixed_plot_args</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_histogram</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">,</span>
                        <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="n">catalog</span><span class="o">=</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">obs_catalog_repr</span><span class="p">,</span>
                        <span class="n">plot_args</span><span class="o">=</span><span class="n">plot_args</span><span class="p">,</span>
                        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                        <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                        <span class="n">percentile</span><span class="o">=</span><span class="n">percentile</span><span class="p">)</span>

    <span class="c1"># annotate plot with p-values</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">chained</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                <span class="s1">&#39;$\delta_1 = P(X \geq x) = </span><span class="si">{:.2f}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">$\delta_2 = P(X \leq x) = </span><span class="si">{:.2f}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">$\omega = </span><span class="si">{:d}</span><span class="s1">$&#39;</span>
                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span>
                        <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">),</span>
                <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\gamma = P(X \leq x) = </span><span class="si">{:.2f}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">$\omega = </span><span class="si">{:.2f}</span><span class="s1">$&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span>
                                <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xlabel_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">ylabel_fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tight_layout</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># func has different return types, before release refactor and remove plotting from evaluation.</span>
    <span class="c1"># plotting should be separated from evaluation.</span>
    <span class="c1"># evaluation should return some object that can be plotted maybe with verbose option.</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_magnitude_test">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_magnitude_test.html#csep.utils.plots.plot_magnitude_test">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_magnitude_test</span><span class="p">(</span><span class="n">evaluation_result</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes result from evaluation and generates a specific histogram plot to show the results of the statistical evaluation</span>
<span class="sd">    for the M-test.</span>

<span class="sd">    Args:</span>
<span class="sd">        evaluation_result: object-like var that implements the interface of the above EvaluationResult</span>
<span class="sd">        axes (matplotlib.Axes): axes object used to chain this plot</span>
<span class="sd">        show (bool): if true, call pyplot.show()</span>
<span class="sd">        plot_args(dict): optional argument containing a dictionary of plotting arguments, with keys as strings and items as described below</span>

<span class="sd">    Optional plotting arguments:</span>
<span class="sd">        * figsize: (:class:`list`/:class:`tuple`) - default: [6.4, 4.8]</span>
<span class="sd">        * title: (:class:`str`) - default: name of the first evaluation result type</span>
<span class="sd">        * title_fontsize: (:class:`float`) Fontsize of the plot title - default: 10</span>
<span class="sd">        * xlabel: (:class:`str`) - default: &#39;X&#39;</span>
<span class="sd">        * xlabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * xticks_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * ylabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * tight_layout: (:class:`bool`) Set matplotlib.figure.tight_layout to remove excess blank space in the plot - default: True</span>
<span class="sd">        * percentile (:class:`float`) Critial region to shade on histogram - default: 95</span>
<span class="sd">        * bins: (:class:`str`) - Set binning type. see matplotlib.hist for more info - default: &#39;auto&#39;</span>
<span class="sd">        * xy: (:class:`list`/:class:`tuple`) - default: (0.55, 0.6)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax (matplotlib.Axes): containing the new plot</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Magnitude Test&#39;</span><span class="p">)</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;D* Statistic&#39;</span><span class="p">)</span>
    <span class="n">xlabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of catalogs&#39;</span><span class="p">)</span>
    <span class="n">ylabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">tight_layout</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tight_layout&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">percentile</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text_fontsize&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>

    <span class="c1"># handle plotting</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># supply fixed arguments to plots</span>
    <span class="c1"># might want to add other defaults here</span>
    <span class="n">fixed_plot_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;obs_label&#39;</span><span class="p">:</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">obs_name</span><span class="p">,</span>
                       <span class="s1">&#39;sim_label&#39;</span><span class="p">:</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">sim_name</span><span class="p">}</span>
    <span class="n">plot_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fixed_plot_args</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_histogram</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">,</span>
                        <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="n">catalog</span><span class="o">=</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">obs_catalog_repr</span><span class="p">,</span>
                        <span class="n">plot_args</span><span class="o">=</span><span class="n">plot_args</span><span class="p">,</span>
                        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                        <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                        <span class="n">percentile</span><span class="o">=</span><span class="n">percentile</span><span class="p">)</span>

    <span class="c1"># annotate plot with quantile values</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">chained</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\gamma = P(X \geq x) = </span><span class="si">{:.2f}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">$\omega = </span><span class="si">{:.2f}</span><span class="s1">$&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span>
                                <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># if both quantiles are provided, we want to plot the greater-equal quantile</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\gamma = P(X \geq x) = </span><span class="si">{:.2f}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">$\omega = </span><span class="si">{:.2f}</span><span class="s1">$&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">quantile</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xlabel_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">ylabel_fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tight_layout</span><span class="p">:</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span><span class="o">.</span><span class="n">tight_layout</span>
        <span class="p">()</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># func has different return types, before release refactor and remove plotting from evaluation.</span>
    <span class="c1"># plotting should be separated from evaluation.</span>
    <span class="c1"># evaluation should return some object that can be plotted maybe with verbose option.</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_distribution_test">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_distribution_test.html#csep.utils.plots.plot_distribution_test">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_distribution_test</span><span class="p">(</span><span class="n">evaluation_result</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes result from evaluation and generates a specific histogram plot to show the results of the statistical evaluation</span>
<span class="sd">    for the M-test.</span>


<span class="sd">    Args:</span>
<span class="sd">        evaluation_result: object-like var that implements the interface of the above EvaluationResult</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax (matplotlib.axes.Axes): can be used to modify the figure</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="c1"># handle plotting</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># supply fixed arguments to plots</span>
    <span class="c1"># might want to add other defaults here</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">fixed_plot_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;obs_label&#39;</span><span class="p">:</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">obs_name</span><span class="p">,</span>
                       <span class="s1">&#39;sim_label&#39;</span><span class="p">:</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">sim_name</span><span class="p">}</span>
    <span class="n">plot_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fixed_plot_args</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">percentile</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_histogram</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">,</span>
                        <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="n">catalog</span><span class="o">=</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">obs_catalog_repr</span><span class="p">,</span>
                        <span class="n">plot_args</span><span class="o">=</span><span class="n">plot_args</span><span class="p">,</span>
                        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                        <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                        <span class="n">percentile</span><span class="o">=</span><span class="n">percentile</span><span class="p">)</span>

    <span class="c1"># annotate plot with p-values</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">chained</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\gamma = P(X \leq x) = </span><span class="si">{:.3f}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">$\omega$ = </span><span class="si">{:.3f}</span><span class="s1">&#39;</span>
                    <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span>
                            <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">),</span>
                    <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># func has different return types, before release refactor and remove plotting from evaluation.</span>
    <span class="c1"># plotting should be separated from evaluation.</span>
    <span class="c1"># evaluation should return some object that can be plotted maybe with verbose option.</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_likelihood_test">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_likelihood_test.html#csep.utils.plots.plot_likelihood_test">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_likelihood_test</span><span class="p">(</span><span class="n">evaluation_result</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes result from evaluation and generates a specific histogram plot to show the results of the statistical evaluation</span>
<span class="sd">    for the L-test.</span>

<span class="sd">    Args:</span>
<span class="sd">        evaluation_result: object-like var that implements the interface of the above EvaluationResult</span>
<span class="sd">        axes (matplotlib.Axes): axes object used to chain this plot</span>
<span class="sd">        show (bool): if true, call pyplot.show()</span>
<span class="sd">        plot_args(dict): optional argument containing a dictionary of plotting arguments, with keys as strings and items as described below</span>

<span class="sd">    Optional plotting arguments:</span>
<span class="sd">        * figsize: (:class:`list`/:class:`tuple`) - default: [6.4, 4.8]</span>
<span class="sd">        * title: (:class:`str`) - default: name of the first evaluation result type</span>
<span class="sd">        * title_fontsize: (:class:`float`) Fontsize of the plot title - default: 10</span>
<span class="sd">        * xlabel: (:class:`str`) - default: &#39;X&#39;</span>
<span class="sd">        * xlabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * xticks_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * ylabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * text_fontsize: (:class:`float`) - default: 14</span>
<span class="sd">        * tight_layout: (:class:`bool`) Set matplotlib.figure.tight_layout to remove excess blank space in the plot - default: True</span>
<span class="sd">        * percentile (:class:`float`) Critial region to shade on histogram - default: 95</span>
<span class="sd">        * bins: (:class:`str`) - Set binning type. see matplotlib.hist for more info - default: &#39;auto&#39;</span>
<span class="sd">        * xy: (:class:`list`/:class:`tuple`) - default: (0.55, 0.3)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax (matplotlib.axes.Axes): can be used to modify the figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Pseudo-likelihood Test&#39;</span><span class="p">)</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Pseudo likelihood&#39;</span><span class="p">)</span>
    <span class="n">xlabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of catalogs&#39;</span><span class="p">)</span>
    <span class="n">ylabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text_fontsize&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">tight_layout</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tight_layout&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">percentile</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>

    <span class="c1"># handle plotting</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1"># supply fixed arguments to plots</span>
    <span class="c1"># might want to add other defaults here</span>
    <span class="n">fixed_plot_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;obs_label&#39;</span><span class="p">:</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">obs_name</span><span class="p">,</span>
                       <span class="s1">&#39;sim_label&#39;</span><span class="p">:</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">sim_name</span><span class="p">}</span>
    <span class="n">plot_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fixed_plot_args</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_histogram</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">,</span>
                        <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="n">catalog</span><span class="o">=</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">obs_catalog_repr</span><span class="p">,</span>
                        <span class="n">plot_args</span><span class="o">=</span><span class="n">plot_args</span><span class="p">,</span>
                        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                        <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                        <span class="n">percentile</span><span class="o">=</span><span class="n">percentile</span><span class="p">)</span>

    <span class="c1"># annotate plot with p-values</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">chained</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\gamma = P(X \leq x) = </span><span class="si">{:.2f}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">$\omega = </span><span class="si">{:.2f}</span><span class="s1">$&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span>
                                <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># if both quantiles are provided, we want to plot the greater-equal quantile</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\gamma = P(X \leq x) = </span><span class="si">{:.2f}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">$\omega = </span><span class="si">{:.2f}</span><span class="s1">$&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">quantile</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xlabel_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">ylabel_fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tight_layout</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># func has different return types, before release refactor and remove plotting from evaluation.</span>
    <span class="c1"># plotting should be separated from evaluation.</span>
    <span class="c1"># evaluation should return some object that can be plotted maybe with verbose option.</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_spatial_test">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_spatial_test.html#csep.utils.plots.plot_spatial_test">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_spatial_test</span><span class="p">(</span><span class="n">evaluation_result</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot spatial test result from catalog based forecast</span>

<span class="sd">    Args:</span>
<span class="sd">        evaluation_result: object-like var that implements the interface of the above EvaluationResult</span>
<span class="sd">        axes (matplotlib.Axes): axes object used to chain this plot</span>
<span class="sd">        show (bool): if true, call pyplot.show()</span>
<span class="sd">        plot_args(dict): optional argument containing a dictionary of plotting arguments, with keys as strings and items as described below</span>

<span class="sd">    Optional plotting arguments:</span>
<span class="sd">        * figsize: (:class:`list`/:class:`tuple`) - default: [6.4, 4.8]</span>
<span class="sd">        * title: (:class:`str`) - default: name of the first evaluation result type</span>
<span class="sd">        * title_fontsize: (:class:`float`) Fontsize of the plot title - default: 10</span>
<span class="sd">        * xlabel: (:class:`str`) - default: &#39;X&#39;</span>
<span class="sd">        * xlabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * xticks_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * ylabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * text_fontsize: (:class:`float`) - default: 14</span>
<span class="sd">        * tight_layout: (:class:`bool`) Set matplotlib.figure.tight_layout to remove excess blank space in the plot - default: True</span>
<span class="sd">        * percentile (:class:`float`) Critial region to shade on histogram - default: 95</span>
<span class="sd">        * bins: (:class:`str`) - Set binning type. see matplotlib.hist for more info - default: &#39;auto&#39;</span>
<span class="sd">        * xy: (:class:`list`/:class:`tuple`) - default: (0.2, 0.6)</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax (matplotlib.axes.Axes): can be used to modify the figure</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Spatial Test&#39;</span><span class="p">)</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Normalized pseudo-likelihood&#39;</span><span class="p">)</span>
    <span class="n">xlabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of catalogs&#39;</span><span class="p">)</span>
    <span class="n">ylabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;text_fontsize&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">tight_layout</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tight_layout&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">percentile</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bins&#39;</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">))</span>

    <span class="c1"># handle plotting</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chained</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># supply fixed arguments to plots</span>
    <span class="c1"># might want to add other defaults here</span>
    <span class="n">fixed_plot_args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;obs_label&#39;</span><span class="p">:</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">obs_name</span><span class="p">,</span>
                       <span class="s1">&#39;sim_label&#39;</span><span class="p">:</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">sim_name</span><span class="p">}</span>
    <span class="n">plot_args</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fixed_plot_args</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">plot_histogram</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">,</span>
                        <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="n">catalog</span><span class="o">=</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">obs_catalog_repr</span><span class="p">,</span>
                        <span class="n">plot_args</span><span class="o">=</span><span class="n">plot_args</span><span class="p">,</span>
                        <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
                        <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                        <span class="n">percentile</span><span class="o">=</span><span class="n">percentile</span><span class="p">)</span>

    <span class="c1"># annotate plot with p-values</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">chained</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\gamma = P(X \leq x) = </span><span class="si">{:.2f}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">$\omega = </span><span class="si">{:.2f}</span><span class="s1">$&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span>
                                <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># if both quantiles are provided, we want to plot the greater-equal quantile</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;$\gamma = P(X \leq x) = </span><span class="si">{:.2f}</span><span class="s1">$</span><span class="se">\n</span><span class="s1">$\omega = </span><span class="si">{:.2f}</span><span class="s1">$&#39;</span>
                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">quantile</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">evaluation_result</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="n">xy</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xlabel_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">ylabel_fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">tight_layout</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="c1"># func has different return types, before release refactor and remove plotting from evaluation.</span>
    <span class="c1"># plotting should be separated from evaluation.</span>
    <span class="c1"># evaluation should return some object that can be plotted maybe with verbose option.</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_calibration_test">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_calibration_test.html#csep.utils.plots.plot_calibration_test">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_calibration_test</span><span class="p">(</span><span class="n">evaluation_result</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># set up QQ plots and KS test</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># plotting points for uniform quantiles</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># compute confidence intervals for order statistics using beta distribution</span>
    <span class="n">ulow</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">uhigh</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.975</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># get stuff from plot_args</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">evaluation_result</span><span class="o">.</span><span class="n">sim_name</span><span class="p">)</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlim&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylim&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">])</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Quantile scores&#39;</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Standard uniform quantiles&#39;</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;tab:blue&#39;</span><span class="p">)</span>
    <span class="n">marker</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;marker&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;best&#39;</span><span class="p">)</span>

    <span class="c1"># quantiles should be sorted for plotting</span>
    <span class="n">sorted_td</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">evaluation_result</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>

    <span class="c1"># plot qq plot</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sorted_td</span><span class="p">,</span> <span class="n">pp</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
    <span class="c1"># plot uncertainty on uniform quantiles</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="n">pp</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ulow</span><span class="p">,</span> <span class="n">pp</span><span class="p">,</span> <span class="s1">&#39;:k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">uhigh</span><span class="p">,</span> <span class="n">pp</span><span class="p">,</span> <span class="s1">&#39;:k&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_poisson_consistency_test">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_poisson_consistency_test.html#csep.utils.plots.plot_poisson_consistency_test">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_poisson_consistency_test</span><span class="p">(</span><span class="n">eval_results</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">one_sided_lower</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plots results from CSEP1 tests following the CSEP1 convention.</span>

<span class="sd">    Note: All of the evaluations should be from the same type of evaluation, otherwise the results will not be</span>
<span class="sd">          comparable on the same figure.</span>

<span class="sd">    Args:</span>
<span class="sd">        results (list): Contains the tests results :class:`csep.core.evaluations.EvaluationResult` (see note above)</span>
<span class="sd">        normalize (bool): select this if the forecast likelihood should be normalized by the observed likelihood. useful</span>
<span class="sd">                          for plotting simulation based simulation tests.</span>
<span class="sd">        one_sided_lower (bool): select this if the plot should be for a one sided test</span>
<span class="sd">        plot_args(dict): optional argument containing a dictionary of plotting arguments, with keys as strings and items as described below</span>

<span class="sd">    Optional plotting arguments:</span>
<span class="sd">        * figsize: (:class:`list`/:class:`tuple`) - default: [6.4, 4.8]</span>
<span class="sd">        * title: (:class:`str`) - default: name of the first evaluation result type</span>
<span class="sd">        * title_fontsize: (:class:`float`) Fontsize of the plot title - default: 10</span>
<span class="sd">        * xlabel: (:class:`str`) - default: &#39;X&#39;</span>
<span class="sd">        * xlabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * xticks_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * ylabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * color: (:class:`float`/:class:`None`) If None, sets it to red/green according to :func:`_get_marker_style` - default: &#39;black&#39;</span>
<span class="sd">        * linewidth: (:class:`float`) - default: 1.5</span>
<span class="sd">        * capsize: (:class:`float`) - default: 4</span>
<span class="sd">        * hbars:  (:class:`bool`)  Flag to draw horizontal bars for each model - default: True</span>
<span class="sd">        * tight_layout: (:class:`bool`) Set matplotlib.figure.tight_layout to remove excess blank space in the plot - default: True</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax (:class:`matplotlib.pyplot.axes` object)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">eval_results</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">eval_results</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="c1"># Parse plot arguments. More can be added here</span>
    <span class="k">if</span> <span class="n">plot_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">xlabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xticks_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xticks_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ylabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">capsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;capsize&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">hbars</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hbars&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">tight_layout</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tight_layout&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">percentile</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">plot_mean</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="n">xlims</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
        <span class="c1"># handle analytical distributions first, they are all in the form [&#39;name&#39;, parameters].</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;poisson&#39;</span><span class="p">:</span>
            <span class="n">plow</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="o">.</span><span class="n">ppf</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                           <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">phigh</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                            <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">observed_statistic</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">observed_statistic</span>
        <span class="c1"># empirical distributions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">test_distribution</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">)</span> <span class="o">-</span> <span class="n">res</span><span class="o">.</span><span class="n">observed_statistic</span>
                <span class="n">observed_statistic</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">test_distribution</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">)</span>
                <span class="n">observed_statistic</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">observed_statistic</span>
            <span class="c1"># compute distribution depending on type of test</span>
            <span class="k">if</span> <span class="n">one_sided_lower</span><span class="p">:</span>
                <span class="n">plow</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_distribution</span><span class="p">,</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">percentile</span><span class="p">)</span>
                <span class="n">phigh</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_distribution</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plow</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_distribution</span><span class="p">,</span>
                                        <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">percentile</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
                <span class="n">phigh</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_distribution</span><span class="p">,</span>
                                         <span class="mi">100</span> <span class="o">-</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">percentile</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">test_distribution</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span>
                <span class="n">observed_statistic</span><span class="p">):</span>  <span class="c1"># Check if test result does not diverges</span>
            <span class="n">percentile_lims</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">mean</span> <span class="o">-</span> <span class="n">plow</span><span class="p">,</span>
                                                      <span class="n">phigh</span> <span class="o">-</span> <span class="n">mean</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">observed_statistic</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span>
                    <span class="n">_get_marker_style</span><span class="p">(</span><span class="n">observed_statistic</span><span class="p">,</span> <span class="p">(</span><span class="n">plow</span><span class="p">,</span> <span class="n">phigh</span><span class="p">),</span>
                                      <span class="n">one_sided_lower</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">percentile_lims</span><span class="p">,</span>
                        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ko&#39;</span> <span class="o">*</span> <span class="n">plot_mean</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="n">capsize</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="c1"># determine the limits to use</span>
            <span class="n">xlims</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">plow</span><span class="p">,</span> <span class="n">phigh</span><span class="p">,</span> <span class="n">observed_statistic</span><span class="p">))</span>
            <span class="c1"># we want to only extent the distribution where it falls outside of it in the acceptable tail</span>
            <span class="k">if</span> <span class="n">one_sided_lower</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">observed_statistic</span> <span class="o">&gt;=</span> <span class="n">plow</span> <span class="ow">and</span> <span class="n">phigh</span> <span class="o">&lt;</span> <span class="n">observed_statistic</span><span class="p">:</span>
                    <span class="c1"># draw dashed line to infinity</span>
                    <span class="n">xt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">phigh</span><span class="p">,</span> <span class="mi">99999</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="n">yt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">index</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Observed statistic diverges for forecast </span><span class="si">%s</span><span class="s1">, index </span><span class="si">%i</span><span class="s1">.&#39;</span>
                  <span class="s1">&#39; Check for zero-valued bins within the forecast&#39;</span> <span class="o">%</span> <span class="p">(</span>
                      <span class="n">res</span><span class="o">.</span><span class="n">sim_name</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">99999</span><span class="p">,</span> <span class="n">left</span><span class="o">=-</span><span class="mi">10000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">],</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">_get_axis_limits</span><span class="p">(</span><span class="n">xlims</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;All EvaluationResults have infinite &#39;</span>
                         <span class="s1">&#39;observed_statistics&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="n">res</span><span class="o">.</span><span class="n">sim_name</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span><span class="p">],</span>
                       <span class="n">fontsize</span><span class="o">=</span><span class="n">ylabel_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">hbars</span><span class="p">:</span>
        <span class="n">yTickPos</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yTickPos</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">yTickPos</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">99999</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">yTickPos</span><span class="p">)),</span>
                    <span class="n">left</span><span class="o">=-</span><span class="mi">10000</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">yTickPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yTickPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">],</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xlabel_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">xticks_fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tight_layout</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<div class="viewcode-block" id="plot_comparison_test">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.plot_comparison_test.html#csep.utils.plots.plot_comparison_test">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_comparison_test</span><span class="p">(</span><span class="n">results_t</span><span class="p">,</span> <span class="n">results_w</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots list of T-Test (and W-Test) Results&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">plot_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_args</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;CSEP1 Comparison Test&#39;</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel&#39;</span><span class="p">,</span> <span class="s1">&#39;Information gain per earthquake&#39;</span><span class="p">)</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylim&#39;</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="n">capsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;capsize&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">markersize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;markersize&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">percentile</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">xticklabels_rotation</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xticklabels_rotation&#39;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">xlabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel_fontsize&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="n">ylabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel_fontsize&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

    <span class="n">Results</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">results_t</span><span class="p">,</span> <span class="n">results_w</span><span class="p">)</span> <span class="k">if</span> <span class="n">results_w</span> <span class="k">else</span> <span class="nb">zip</span><span class="p">(</span><span class="n">results_t</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Results</span><span class="p">):</span>
        <span class="n">result_t</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">result_w</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">results_w</span> <span class="k">else</span> <span class="kc">None</span>

        <span class="n">ylow</span> <span class="o">=</span> <span class="n">result_t</span><span class="o">.</span><span class="n">observed_statistic</span> <span class="o">-</span> <span class="n">result_t</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yhigh</span> <span class="o">=</span> <span class="n">result_t</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">result_t</span><span class="o">.</span><span class="n">observed_statistic</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">_get_marker_t_color</span><span class="p">(</span><span class="n">result_t</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">result_t</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Diverging information gain for forecast </span><span class="si">%s</span><span class="s1">, index </span><span class="si">%i</span><span class="s1">.&#39;</span>
                  <span class="s1">&#39; Check for zero-valued bins within the forecast&#39;</span> <span class="o">%</span>
                  <span class="p">(</span><span class="n">result_t</span><span class="o">.</span><span class="n">sim_name</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">index</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">result_t</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="n">yerr</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ylow</span><span class="p">,</span> <span class="n">yhigh</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="n">capsize</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result_w</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_get_marker_w_color</span><span class="p">(</span><span class="n">result_w</span><span class="o">.</span><span class="n">quantile</span><span class="p">,</span> <span class="n">percentile</span><span class="p">):</span>
                    <span class="n">facecolor</span> <span class="o">=</span> <span class="n">_get_marker_t_color</span><span class="p">(</span><span class="n">result_t</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">result_t</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                    <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results_t</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="n">res</span><span class="o">.</span><span class="n">sim_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results_t</span><span class="p">],</span>
                       <span class="n">rotation</span><span class="o">=</span><span class="n">xticklabels_rotation</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xlabel_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">ylabel_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">xTickPos</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results_t</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results_t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">xTickPos</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">9999</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">xTickPos</span><span class="p">)),</span> <span class="n">bottom</span><span class="o">=-</span><span class="mi">2000</span><span class="p">,</span>
               <span class="n">width</span><span class="o">=</span><span class="p">(</span><span class="n">xTickPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xTickPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">plot_consistency_test</span><span class="p">(</span><span class="n">eval_results</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">one_sided_lower</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plots results from CSEP1 tests following the CSEP1 convention.</span>

<span class="sd">    Note: All of the evaluations should be from the same type of evaluation, otherwise the results will not be</span>
<span class="sd">          comparable on the same figure.</span>

<span class="sd">    Args:</span>
<span class="sd">        eval_results (list): Contains the tests results :class:`csep.core.evaluations.EvaluationResult` (see note above)</span>
<span class="sd">        normalize (bool): select this if the forecast likelihood should be normalized by the observed likelihood. useful</span>
<span class="sd">                          for plotting simulation based simulation tests.</span>
<span class="sd">        one_sided_lower (bool): select this if the plot should be for a one sided test</span>
<span class="sd">        plot_args(dict): optional argument containing a dictionary of plotting arguments, with keys as strings and items as described below</span>

<span class="sd">    Optional plotting arguments:</span>
<span class="sd">        * figsize: (:class:`list`/:class:`tuple`) - default: [6.4, 4.8]</span>
<span class="sd">        * title: (:class:`str`) - default: name of the first evaluation result type</span>
<span class="sd">        * title_fontsize: (:class:`float`) Fontsize of the plot title - default: 10</span>
<span class="sd">        * xlabel: (:class:`str`) - default: &#39;X&#39;</span>
<span class="sd">        * xlabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * xticks_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * ylabel_fontsize: (:class:`float`) - default: 10</span>
<span class="sd">        * color: (:class:`float`/:class:`None`) If None, sets it to red/green according to :func:`_get_marker_style` - default: &#39;black&#39;</span>
<span class="sd">        * linewidth: (:class:`float`) - default: 1.5</span>
<span class="sd">        * capsize: (:class:`float`) - default: 4</span>
<span class="sd">        * hbars:  (:class:`bool`)  Flag to draw horizontal bars for each model - default: True</span>
<span class="sd">        * tight_layout: (:class:`bool`) Set matplotlib.figure.tight_layout to remove excess blank space in the plot - default: True</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax (:class:`matplotlib.pyplot.axes` object)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">eval_results</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">eval_results</span><span class="p">]</span>
    <span class="n">results</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="c1"># Parse plot arguments. More can be added here</span>
    <span class="k">if</span> <span class="n">plot_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_args</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">xlabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xlabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">xticks_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xticks_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">ylabel_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ylabel_fontsize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">linewidth</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;linewidth&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">capsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;capsize&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">hbars</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hbars&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">tight_layout</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tight_layout&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">percentile</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;percentile&#39;</span><span class="p">,</span> <span class="mi">95</span><span class="p">)</span>
    <span class="n">plot_mean</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>

    <span class="n">xlims</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">res</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
        <span class="c1"># handle analytical distributions first, they are all in the form [&#39;name&#39;, parameters].</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;poisson&#39;</span><span class="p">:</span>
            <span class="n">plow</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="o">.</span><span class="n">ppf</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                           <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">phigh</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                            <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">observed_statistic</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">observed_statistic</span>

        <span class="k">elif</span> <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;negative_binomial&#39;</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">variance</span>
            <span class="n">observed_statistic</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">observed_statistic</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">upsilon</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">((</span><span class="n">var</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">var</span><span class="p">)</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">var</span> <span class="o">-</span> <span class="n">mean</span><span class="p">))</span>
            <span class="n">plow</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">nbinom</span><span class="o">.</span><span class="n">ppf</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span>
                                           <span class="n">upsilon</span><span class="p">)</span>
            <span class="n">phigh</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">nbinom</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                          <span class="n">tau</span><span class="p">,</span> <span class="n">upsilon</span><span class="p">)</span>

        <span class="c1"># empirical distributions</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">test_distribution</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">)</span> <span class="o">-</span> <span class="n">res</span><span class="o">.</span><span class="n">observed_statistic</span>
                <span class="n">observed_statistic</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">test_distribution</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">)</span>
                <span class="n">observed_statistic</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">observed_statistic</span>
            <span class="c1"># compute distribution depending on type of test</span>
            <span class="k">if</span> <span class="n">one_sided_lower</span><span class="p">:</span>
                <span class="n">plow</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_distribution</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">phigh</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_distribution</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plow</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_distribution</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
                <span class="n">phigh</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_distribution</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span>
                <span class="n">observed_statistic</span><span class="p">):</span>  <span class="c1"># Check if test result does not diverges</span>
            <span class="n">percentile_lims</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">mean</span> <span class="o">-</span> <span class="n">plow</span><span class="p">,</span> <span class="n">phigh</span> <span class="o">-</span> <span class="n">mean</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">observed_statistic</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span>
                    <span class="n">_get_marker_style</span><span class="p">(</span><span class="n">observed_statistic</span><span class="p">,</span> <span class="p">(</span><span class="n">plow</span><span class="p">,</span> <span class="n">phigh</span><span class="p">),</span>
                                      <span class="n">one_sided_lower</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">percentile_lims</span><span class="p">,</span>
                        <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;ko&#39;</span> <span class="o">*</span> <span class="n">plot_mean</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="n">capsize</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="c1"># determine the limits to use</span>
            <span class="n">xlims</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">plow</span><span class="p">,</span> <span class="n">phigh</span><span class="p">,</span> <span class="n">observed_statistic</span><span class="p">))</span>
            <span class="c1"># we want to only extent the distribution where it falls outside of it in the acceptable tail</span>
            <span class="k">if</span> <span class="n">one_sided_lower</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">observed_statistic</span> <span class="o">&gt;=</span> <span class="n">plow</span> <span class="ow">and</span> <span class="n">phigh</span> <span class="o">&lt;</span> <span class="n">observed_statistic</span><span class="p">:</span>
                    <span class="c1"># draw dashed line to infinity</span>
                    <span class="n">xt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">phigh</span><span class="p">,</span> <span class="mi">99999</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="n">yt</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">index</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Observed statistic diverges for forecast </span><span class="si">%s</span><span class="s1">, index </span><span class="si">%i</span><span class="s1">.&#39;</span>
                  <span class="s1">&#39; Check for zero-valued bins within the forecast&#39;</span> <span class="o">%</span> <span class="p">(</span>
                      <span class="n">res</span><span class="o">.</span><span class="n">sim_name</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="mi">99999</span><span class="p">,</span> <span class="n">left</span><span class="o">=-</span><span class="mi">10000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;red&#39;</span><span class="p">],</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="n">_get_axis_limits</span><span class="p">(</span><span class="n">xlims</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;All EvaluationResults have infinite observed_statistics&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="n">res</span><span class="o">.</span><span class="n">sim_name</span> <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">results</span><span class="p">],</span>
                       <span class="n">fontsize</span><span class="o">=</span><span class="n">ylabel_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">hbars</span><span class="p">:</span>
        <span class="n">yTickPos</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">yTickPos</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">yTickPos</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">99999</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">yTickPos</span><span class="p">)),</span>
                    <span class="n">left</span><span class="o">=-</span><span class="mi">10000</span><span class="p">,</span>
                    <span class="n">height</span><span class="o">=</span><span class="p">(</span><span class="n">yTickPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yTickPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">],</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xlabel_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">xticks_fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tight_layout</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_pvalues_and_intervals</span><span class="p">(</span><span class="n">test_results</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plots p-values and intervals for a list of Poisson or NBD test results</span>

<span class="sd">    Args:</span>
<span class="sd">        test_results (list): list of EvaluationResults for N-test. All tests should use the same distribution</span>
<span class="sd">                             (ie Poisson or NBD).</span>
<span class="sd">        ax (matplotlib.axes.Axes.axis): axes to use for plot. create using matplotlib</span>
<span class="sd">        var (float): variance of the NBD distribution. Must be used for NBD plots.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ax (matplotlib.axes.Axes.axis): axes handle containing this plot</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: throws error if NBD tests are supplied without a variance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">variance</span> <span class="o">=</span> <span class="n">var</span>
    <span class="n">percentile</span> <span class="o">=</span> <span class="mf">97.5</span>
    <span class="n">p_values</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Differentiate between N-tests and other consistency tests</span>
    <span class="k">if</span> <span class="n">test_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;NBD N-Test&#39;</span> <span class="ow">or</span> <span class="n">test_results</span><span class="p">[</span>
        <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Poisson N-Test&#39;</span><span class="p">:</span>
        <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;p &lt; 10e-5&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FF7F50&#39;</span><span class="p">,</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;10e-5 $\leq$ p &lt; 10e-4&#39;</span><span class="p">,</span>
                                    <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;10e-4 $\leq$ p &lt; 10e-3&#39;</span><span class="p">,</span>
                                    <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;10e-3 $\leq$ p &lt; 0.0125&#39;</span><span class="p">,</span>
                                    <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;0.0125 $\leq$ p &lt; 0.025&#39;</span><span class="p">,</span>
                                    <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;p $\geq$ 0.025&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="c1"># Act on Negative binomial tests</span>
        <span class="k">if</span> <span class="n">test_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;NBD N-Test&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;var must not be None if N-tests use the NBD distribution.&quot;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)):</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">upsilon</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="p">((</span><span class="n">variance</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">variance</span><span class="p">)</span>
                <span class="n">tau</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">variance</span> <span class="o">-</span> <span class="n">mean</span><span class="p">))</span>
                <span class="n">phigh97</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">nbinom</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">upsilon</span>
                <span class="p">)</span>
                <span class="n">plow97</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">nbinom</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span>
                    <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">upsilon</span>
                <span class="p">)</span>
                <span class="n">low97</span> <span class="o">=</span> <span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span> <span class="o">-</span> <span class="n">plow97</span>
                <span class="n">high97</span> <span class="o">=</span> <span class="n">phigh97</span> <span class="o">-</span> <span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span>
                            <span class="n">xerr</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">low97</span><span class="p">,</span> <span class="n">high97</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;slategray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">[</span>
                                    <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span>  <span class="c1"># Calculated p-values according to Meletti et al., (2021)</span>

                <span class="k">if</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10e-5</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">10e-5</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10e-4</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FF7F50&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">10e-4</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10e-3</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">10e-3</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0125</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0125</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.025</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.025</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1"># Act on Poisson N-test</span>
        <span class="k">if</span> <span class="n">test_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Poisson N-Test&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)):</span>
                <span class="n">plow97</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="o">.</span><span class="n">ppf</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                                                 <span class="n">test_results</span><span class="p">[</span>
                                                     <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">phigh97</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">poisson</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span>
                    <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mf">100.</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">,</span>
                    <span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">low97</span> <span class="o">=</span> <span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span> <span class="o">-</span> <span class="n">plow97</span>
                <span class="n">high97</span> <span class="o">=</span> <span class="n">phigh97</span> <span class="o">-</span> <span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span>
                            <span class="n">xerr</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">low97</span><span class="p">,</span> <span class="n">high97</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;slategray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10e-5</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">10e-5</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10e-4</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FF7F50&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">10e-4</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10e-3</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">10e-3</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0125</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0125</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.025</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.025</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                            <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Operate on all other consistency tests</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)):</span>
            <span class="n">plow97</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
            <span class="n">phigh97</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">test_distribution</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">)</span>
            <span class="n">low97</span> <span class="o">=</span> <span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span> <span class="o">-</span> <span class="n">plow97</span>
            <span class="n">high97</span> <span class="o">=</span> <span class="n">phigh97</span> <span class="o">-</span> <span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span>
                        <span class="n">xerr</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">low97</span><span class="p">,</span> <span class="n">high97</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;slategray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10e-5</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
                        <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">10e-5</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10e-4</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FF7F50&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">10e-4</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">10e-3</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span>
                        <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">10e-3</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.025</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                        <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.025</span> <span class="ow">and</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">p_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.05</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">observed_statistic</span><span class="p">,</span>
                        <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
                        <span class="n">markersize</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;p &lt; 10e-5&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#FF7F50&#39;</span><span class="p">,</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;10e-5 $\leq$ p &lt; 10e-4&#39;</span><span class="p">,</span>
                                    <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gold&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;10e-4 $\leq$ p &lt; 10e-3&#39;</span><span class="p">,</span>
                                    <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;10e-3 $\leq$ p &lt; 0.025&#39;</span><span class="p">,</span>
                                    <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span>
                                    <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;0.025 $\leq$ p &lt; 0.05&#39;</span><span class="p">,</span>
                                    <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">),</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;p $\geq$ 0.05&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)]</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_concentration_ROC_diagram</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">catalog</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_uniform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">savepdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">savepng</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot Receiver operating characteristic (ROC) Curves based on forecast and test catalog.</span>

<span class="sd">    The ROC is computed following this procedure:</span>
<span class="sd">        (1) Obtain spatial rates from GriddedForecast</span>
<span class="sd">        (2) Rank the rates in descending order (highest rates first).</span>
<span class="sd">        (3) Sort forecasted rates by ordering found in (2), and normalize rates so the cumulative sum equals unity.</span>
<span class="sd">        (4) Obtain binned spatial rates from observed catalog</span>
<span class="sd">        (5) Sort gridded observed rates by ordering found in (2), and normalize so the cumulative sum equals unity.</span>
<span class="sd">        (6) Compute spatial bin areas, sort by ordering found in (2), and normalize so the cumulative sum equals unity.</span>
<span class="sd">        (7) Plot ordered and cumulated rates (forecast and catalog) against ordered and cumulated bin areas.</span>

<span class="sd">    Note that:</span>
<span class="sd">        (1) The testing catalog and forecast should have exactly the same time-window (duration)</span>
<span class="sd">        (2) Forecasts should be defined over the same region</span>
<span class="sd">        (3) If calling this function multiple times, update the color in plot_args</span>

<span class="sd">    Args:</span>
<span class="sd">        forecast (:class: `csep.forecast.GriddedForecast`):</span>
<span class="sd">        catalog (:class:`AbstractBaseCatalog`): evaluation catalog</span>
<span class="sd">        linear: (bool): if true, a linear x-axis is used; if false a logarithmic x-axis is used.</span>
<span class="sd">        axes (:class:`matplotlib.pyplot.ax`): Previously defined ax object</span>
<span class="sd">        savepdf (str):    output option of pdf file</span>
<span class="sd">        savepng (str):    output option of png file</span>
<span class="sd">        plot_uniform (bool): if true, include uniform forecast on plot</span>

<span class="sd">        Optional plotting arguments:</span>
<span class="sd">            * figsize: (:class:`list`/:class:`tuple`) - default: [9, 8]</span>
<span class="sd">            * forecast_linecolor: (:class:`str`) - default: &#39;black&#39;</span>
<span class="sd">            * title_fontsize: (:class:`float`) Fontsize of the plot title - default: 18</span>
<span class="sd">            * forecast_linecolor: (:class:`str`) - default: &#39;black&#39;</span>
<span class="sd">            * forecast_linestyle: (:class:`str`) - default: &#39;-&#39;</span>
<span class="sd">            * observed_linecolor: (:class:`str`) - default: &#39;blue&#39;</span>
<span class="sd">            * observed_linestyle: (:class:`str`) - default: &#39;-&#39;</span>
<span class="sd">            * forecast_label: (:class:`str`) - default: Observed (Forecast)</span>
<span class="sd">            * legend_fontsize: (:class:`float`) Fontsize of the plot title - default: 16</span>
<span class="sd">            * legend_loc: (:class:`str`) - default: &#39;upper left&#39;</span>
<span class="sd">            * title_fontsize: (:class:`float`) Fontsize of the plot title - default: 18</span>
<span class="sd">            * label_fontsize: (:class:`float`) Fontsize of the plot title - default: 14</span>
<span class="sd">            * title: (:class:`str`) - default: &#39;ROC Curve&#39;</span>
<span class="sd">            * filename: (:class:`str`) - default: roc_curve.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :class:`matplotlib.pyplot.ax` object</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: throws error if CatalogForecast-like object is provided</span>
<span class="sd">        RuntimeError: throws error if Catalog and Forecast do not have the same region</span>

<span class="sd">        Written by Han Bao, UCLA, March 2021. Modified June 2021.</span>
<span class="sd">        Modified by Emanuele Biondini, University of Bologna, May 2024.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">catalog</span><span class="o">.</span><span class="n">region</span> <span class="o">==</span> <span class="n">forecast</span><span class="o">.</span><span class="n">region</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;catalog region and forecast region must be identical.&quot;</span><span class="p">)</span>

    <span class="c1"># Parse plotting arguments</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">forecast_linecolor</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forecast_linecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">forecast_linestyle</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forecast_linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">observed_linecolor</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;observed_linecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">observed_linestyle</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;observed_linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">legend_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_fontsize&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">)</span>
    <span class="n">label_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label_fontsize&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;roc_figure&#39;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;Concentration ROC Curve&#39;</span><span class="p">)</span>

    <span class="c1"># Plot catalog ordered by forecast rates</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="n">forecast_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forecast_label&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Forecast </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">observed_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;observed_label&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Observed </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Initialize figure</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="c1"># This part could be vectorized if optimizations become necessary</span>
    <span class="c1"># Initialize array to store cell area in km^2</span>
    <span class="n">area_km2</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">get_cell_area</span><span class="p">()</span>
    <span class="n">obs_counts</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">spatial_counts</span><span class="p">()</span>

    <span class="c1"># Obtain rates (or counts) aggregated in spatial cells</span>
    <span class="c1"># If CatalogForecast, needs expected rates. Might take some time to compute.</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">spatial_counts</span><span class="p">()</span>

    <span class="c1"># Get index of rates (descending sort)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>

    <span class="c1"># Order forecast and cells rates by highest rate cells first</span>
    <span class="n">fore_norm_sorted</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">rate</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
    <span class="n">area_norm_sorted</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">area_km2</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">area_km2</span><span class="p">)</span>

    <span class="c1"># Compute normalized and sorted rates of observations</span>
    <span class="n">obs_norm_sorted</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">obs_counts</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">obs_counts</span><span class="p">)</span>

    <span class="c1"># Plot uniform forecast</span>
    <span class="k">if</span> <span class="n">plot_uniform</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">area_norm_sorted</span><span class="p">,</span> <span class="n">area_norm_sorted</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Uniform&#39;</span><span class="p">)</span>

    <span class="c1"># Plot sorted and normalized forecast (descending order)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">area_norm_sorted</span><span class="p">,</span> <span class="n">fore_norm_sorted</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">forecast_label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">forecast_linecolor</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">forecast_linestyle</span><span class="p">)</span>

    <span class="c1"># Plot cell-wise rates of observed catalog ordered by forecast rates (descending order)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">area_norm_sorted</span><span class="p">,</span> <span class="n">obs_norm_sorted</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">observed_label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">observed_linecolor</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">observed_linestyle</span><span class="p">)</span>

    <span class="c1"># Plotting arguments</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;True Positive Rate&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;False Positive Rate (Normalized Area)&#39;</span><span class="p">,</span>
                  <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">linear</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">legend_loc</span><span class="o">=</span><span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">linear</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">savepdf</span><span class="p">:</span>
            <span class="n">outFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.pdf&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">savepng</span><span class="p">:</span>
            <span class="n">outFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_ROC_diagram</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">catalog</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_uniform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">savepdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">savepng</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot Receiver operating characteristic (ROC) based on forecast and test catalogs using the contingency table.</span>
<span class="sd">    The ROC is computed following this procedure:</span>
<span class="sd">        (1) Obtain spatial rates from GriddedForecast and the observed events from the observed catalog.</span>
<span class="sd">        (2) Rank the rates in descending order (highest rates first).</span>
<span class="sd">        (3) Sort forecasted rates by ordering found in (2), and normalize rates so their sum is equals unity.</span>
<span class="sd">        (4) Obtain binned spatial rates from observed catalog</span>
<span class="sd">        (5) Sort gridded observed rates by ordering found in (2).</span>
<span class="sd">        (6) Test each ordered and normalized forecasted rate defined in (3) as a threshold value to obtain the</span>
<span class="sd">            corresponding contingency table.</span>
<span class="sd">        (7) Define the H (Success rate) and F (False alarm rate) for each threshold soil using the information provided</span>
<span class="sd">            by the correspondent contingency table defined in (6).</span>

<span class="sd">    Note that:</span>
<span class="sd">        (1) The testing catalog and forecast should have exactly the same time-window (duration)</span>
<span class="sd">        (2) Forecasts should be defined over the same region</span>
<span class="sd">        (3) If calling this function multiple times, update the color in plot_args</span>
<span class="sd">        (4) The user can choose the x-scale (linear or log), see the Args section below</span>

<span class="sd">    Args:</span>
<span class="sd">        forecast (:class: `csep.forecast.GriddedForecast`):</span>
<span class="sd">        catalog (:class:`AbstractBaseCatalog`): evaluation catalog</span>
<span class="sd">        linear: (bool): if true, a linear x-axis is used; if false a logarithmic x-axis is used.</span>
<span class="sd">        axes (:class:`matplotlib.pyplot.ax`): Previously defined ax object</span>
<span class="sd">        savepdf (str):    output option of pdf file</span>
<span class="sd">        savepng (str):    output option of png file</span>
<span class="sd">        plot_uniform (bool): if true, include uniform forecast on plot</span>

<span class="sd">        Optional plotting arguments:</span>
<span class="sd">            * figsize: (:class:`list`/:class:`tuple`) - default: [9, 8]</span>
<span class="sd">            * forecast_linestyle: (:class:`str`) - default: &#39;-&#39;</span>
<span class="sd">            * legend_fontsize: (:class:`float`) Fontsize of the plot title - default: 16</span>
<span class="sd">            * legend_loc: (:class:`str`) - default: &#39;upper left&#39;</span>
<span class="sd">            * title_fontsize: (:class:`float`) Fontsize of the plot title - default: 18</span>
<span class="sd">            * label_fontsize: (:class:`float`) Fontsize of the plot title - default: 14</span>
<span class="sd">            * title: (:class:`str`) - default: ROC Curve from contingency table</span>
<span class="sd">            * filename: (:class:`str`) - default: contingency_roc_figure.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :class:`matplotlib.pyplot.ax` object</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: throws error if CatalogForecast-like object is provided</span>
<span class="sd">        RuntimeError: throws error if Catalog and Forecast do not have the same region</span>

<span class="sd">        Written by Emanuele Biondini, UNIBO, March 2023.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">catalog</span><span class="o">.</span><span class="n">region</span> <span class="o">==</span> <span class="n">forecast</span><span class="o">.</span><span class="n">region</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;catalog region and forecast region must be identical.&quot;</span><span class="p">)</span>

    <span class="c1"># Parse plotting arguments</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">forecast_linestyle</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forecast_linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">legend_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_fontsize&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">label_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label_fontsize&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;ROC Curve from contingency table&#39;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;contingency_roc_figure&#39;</span><span class="p">)</span>

    <span class="c1"># Initialize figure</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="n">forecast_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forecast_label&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">observed_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;observed_label&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Obtain forecast rates (or counts) and observed catalog aggregated in spatial cells</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">spatial_counts</span><span class="p">()</span>
    <span class="n">obs_counts</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">spatial_counts</span><span class="p">()</span>
    <span class="c1"># Define the threshold to be analysed to compile the contingency table and draw the ROC curve</span>

    <span class="c1"># Get index of rates (descending sort)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>

    <span class="c1"># Order forecast and cells rates by highest rate cells first and normalize the rates.</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="p">(</span><span class="n">rate</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
    <span class="n">obs_counts</span> <span class="o">=</span> <span class="n">obs_counts</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>

    <span class="n">Table_ROC</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Threshold&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;Successful_bins&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;Obs_active_bins&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="p">[]</span>

    <span class="p">})</span>

    <span class="c1">#Each forecasted and normalized rate are tested as a threshold value to define the contingency table.</span>
    <span class="k">for</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>

        <span class="n">binary_forecast</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thresholds</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">forecastedYes_observedYes</span> <span class="o">=</span> <span class="n">obs_counts</span><span class="p">[(</span><span class="n">binary_forecast</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">obs_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">forecastedYes_observedNo</span><span class="o">=</span><span class="n">obs_counts</span><span class="p">[(</span><span class="n">binary_forecast</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">obs_counts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">forecastedNo_observedYes</span><span class="o">=</span><span class="n">obs_counts</span><span class="p">[(</span><span class="n">binary_forecast</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">obs_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">forecastedNo_observedNo</span> <span class="o">=</span> <span class="n">obs_counts</span><span class="p">[(</span><span class="n">binary_forecast</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">obs_counts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="c1"># Creating the DataFrame for the contingency table</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Observed&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">forecastedYes_observedYes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">forecastedNo_observedYes</span><span class="p">)],</span>
            <span class="s2">&quot;Not Observed&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">forecastedYes_observedNo</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">forecastedNo_observedNo</span><span class="p">)]</span>
        <span class="p">}</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Forecasted&quot;</span><span class="p">,</span> <span class="s2">&quot;Not Forecasted&quot;</span><span class="p">]</span>
        <span class="n">contingency_df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

        <span class="n">H</span> <span class="o">=</span> <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Observed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Observed&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Not Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Observed&#39;</span><span class="p">])</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Not Observed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Not Observed&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
                <span class="s1">&#39;Not Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Not Observed&#39;</span><span class="p">])</span>

        <span class="n">threshold_row</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Threshold&#39;</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="s1">&#39;Successful_bins&#39;</span><span class="p">:</span> <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Observed&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Obs_active_bins&#39;</span><span class="p">:</span> <span class="n">contingency_df</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
            <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="n">H</span><span class="p">,</span>
            <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="n">F</span>

        <span class="p">}</span>
        <span class="n">threshold_row_df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">threshold_row</span><span class="p">])</span>

        <span class="c1"># Concatena threshold_row_df a Table_molchan</span>
        <span class="n">Table_ROC</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">Table_ROC</span><span class="p">,</span> <span class="n">threshold_row_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># to start the trajecroy in the poin (0,0)</span>
    <span class="n">first_row</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
    <span class="n">Table_ROC</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">first_row</span><span class="p">,</span> <span class="n">Table_ROC</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Plot the ROC curve</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">Table_ROC</span><span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">]),</span> <span class="p">(</span><span class="n">Table_ROC</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">]),</span>
            <span class="n">label</span><span class="o">=</span><span class="n">forecast_label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">forecast_linestyle</span><span class="p">)</span>

    <span class="c1"># Plot uniform forecast</span>
    <span class="k">if</span> <span class="n">plot_uniform</span><span class="p">:</span>
        <span class="n">x_uniform</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
        <span class="n">y_uniform</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_uniform</span><span class="p">,</span> <span class="n">y_uniform</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SUP&#39;</span><span class="p">)</span>
    <span class="c1"># Plotting arguments</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Hit Rate&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Fraction of false alarms&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">linear</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">elif</span> <span class="n">linear</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">savepdf</span><span class="p">:</span>
            <span class="n">outFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.pdf&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">savepng</span><span class="p">:</span>
            <span class="n">outFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_Molchan_diagram</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">catalog</span><span class="p">,</span> <span class="n">linear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_uniform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">savepdf</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">savepng</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">plot_args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the Molchan Diagram based on forecast and test catalogs using the contingency table.</span>
<span class="sd">    The Area Skill score and its error are shown  in the legend</span>

<span class="sd">    The Molchan diagram is computed following this procedure:</span>
<span class="sd">        (1) Obtain spatial rates from GriddedForecast and the observed events from the observed catalog.</span>
<span class="sd">        (2) Rank the rates in descending order (highest rates first).</span>
<span class="sd">        (3) Sort forecasted rates by ordering found in (2), and normalize rates so their sum is equals unity.</span>
<span class="sd">        (4) Obtain binned spatial rates from observed catalog</span>
<span class="sd">        (5) Sort gridded observed rates by ordering found in (2).</span>
<span class="sd">        (6) Test each ordered and normalized forecasted rate defined in (3) as a threshold value to obtain the</span>
<span class="sd">            corresponding contingency table.</span>
<span class="sd">        (7) Define the &quot;nu&quot; (Miss rate) and &quot;tau&quot; (Fraction of spatial alarmed cells) for each threshold soil using the</span>
<span class="sd">            information provided by the correspondent contingency table defined in (6).</span>


<span class="sd">    Note that:</span>
<span class="sd">        (1) The testing catalog and forecast should have exactly the same time-window (duration)</span>
<span class="sd">        (2) Forecasts should be defined over the same region</span>
<span class="sd">        (3) If calling this function multiple times, update the color in plot_args</span>
<span class="sd">        (4) The user can choose the x-scale (linear or log), see the Args section below</span>

<span class="sd">    Args:</span>
<span class="sd">        forecast (:class: `csep.forecast.GriddedForecast`):</span>
<span class="sd">        catalog (:class:`AbstractBaseCatalog`): evaluation catalog</span>
<span class="sd">        linear: (bool): if true, a linear x-axis is used; if false a logarithmic x-axis is used.</span>
<span class="sd">        axes (:class:`matplotlib.pyplot.ax`): Previously defined ax object</span>
<span class="sd">        savepdf (str):    output option of pdf file</span>
<span class="sd">        savepng (str):    output option of png file</span>
<span class="sd">        plot_uniform (bool): if true, include uniform forecast on plot</span>

<span class="sd">        Optional plotting arguments:</span>
<span class="sd">            * figsize: (:class:`list`/:class:`tuple`) - default: [9, 8]</span>
<span class="sd">            * forecast_linestyle: (:class:`str`) - default: &#39;-&#39;</span>
<span class="sd">            * legend_fontsize: (:class:`float`) Fontsize of the plot title - default: 16</span>
<span class="sd">            * legend_loc: (:class:`str`) - default: &#39;lower left&#39;</span>
<span class="sd">            * title_fontsize: (:class:`float`) Fontsize of the plot title - default: 18</span>
<span class="sd">            * label_fontsize: (:class:`float`) Fontsize of the plot title - default: 14</span>
<span class="sd">            * title: (:class:`str`) - default: &#39;Molchan diagram&#39;</span>
<span class="sd">            * filename: (:class:`str`) - default: molchan_diagram.</span>

<span class="sd">    Returns:</span>
<span class="sd">        :class:`matplotlib.pyplot.ax` object</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: throws error if CatalogForecast-like object is provided</span>
<span class="sd">        RuntimeError: throws error if Catalog and Forecast do not have the same region</span>

<span class="sd">        Written by Emanuele Biondini, UNIBO, March 2023.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">catalog</span><span class="o">.</span><span class="n">region</span> <span class="o">==</span> <span class="n">forecast</span><span class="o">.</span><span class="n">region</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;catalog region and forecast region must be identical.&quot;</span><span class="p">)</span>

    <span class="c1"># Parse plotting arguments</span>
    <span class="n">plot_args</span> <span class="o">=</span> <span class="n">plot_args</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">forecast_linestyle</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forecast_linestyle&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
    <span class="n">legend_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_fontsize&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title_fontsize&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">label_fontsize</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;label_fontsize&#39;</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="s1">&#39;molchan_figure&#39;</span><span class="p">)</span>

    <span class="c1"># Initialize figure</span>
    <span class="k">if</span> <span class="n">axes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">name</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="n">forecast_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forecast_label&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">observed_label</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;observed_label&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Obtain forecast rates (or counts) and observed catalog aggregated in spatial cells</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">forecast</span><span class="o">.</span><span class="n">spatial_counts</span><span class="p">()</span>
    <span class="n">obs_counts</span> <span class="o">=</span> <span class="n">catalog</span><span class="o">.</span><span class="n">spatial_counts</span><span class="p">()</span>

    <span class="c1"># Define the threshold to be analysed tp draw the Molchan diagram</span>

    <span class="c1"># Get index of rates (descending sort)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>

    <span class="c1"># Order forecast and cells rates by highest rate cells first</span>
    <span class="n">thresholds</span> <span class="o">=</span> <span class="p">(</span><span class="n">rate</span><span class="p">[</span><span class="n">I</span><span class="p">])</span> <span class="o">/</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span>
    <span class="n">obs_counts</span> <span class="o">=</span> <span class="n">obs_counts</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>

    <span class="n">Table_molchan</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Threshold&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;Successful_bins&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;Obs_active_bins&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;nu&#39;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="s1">&#39;R_score&#39;</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">})</span>

    <span class="c1"># Each forecasted and normalized rate are tested as a threshold value to define the contingency table.</span>
    <span class="k">for</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>

        <span class="n">binary_forecast</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">thresholds</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">forecastedYes_observedYes</span> <span class="o">=</span> <span class="n">obs_counts</span><span class="p">[(</span><span class="n">binary_forecast</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">obs_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">forecastedYes_observedNo</span> <span class="o">=</span> <span class="n">obs_counts</span><span class="p">[(</span><span class="n">binary_forecast</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">obs_counts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">forecastedNo_observedYes</span> <span class="o">=</span> <span class="n">obs_counts</span><span class="p">[(</span><span class="n">binary_forecast</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">obs_counts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="n">forecastedNo_observedNo</span> <span class="o">=</span> <span class="n">obs_counts</span><span class="p">[(</span><span class="n">binary_forecast</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">obs_counts</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>
        <span class="c1"># Creating the DataFrame for the contingency table</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Observed&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">forecastedYes_observedYes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">forecastedNo_observedYes</span><span class="p">)],</span>
            <span class="s2">&quot;Not Observed&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">forecastedYes_observedNo</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">forecastedNo_observedNo</span><span class="p">)]</span>
        <span class="p">}</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Forecasted&quot;</span><span class="p">,</span> <span class="s2">&quot;Not Forecasted&quot;</span><span class="p">]</span>
        <span class="n">contingency_df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Not Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Observed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">contingency_df</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Forecasted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Forecasted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span>
                                                        <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Not Forecasted&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="n">R_score</span> <span class="o">=</span> <span class="p">(</span><span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Observed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">contingency_df</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">-</span> \
                  <span class="p">(</span><span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Not Observed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">contingency_df</span><span class="p">[</span><span class="s1">&#39;Not Observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

        <span class="n">threshold_row</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Threshold&#39;</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="s1">&#39;Successful_bins&#39;</span><span class="p">:</span> <span class="n">contingency_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;Forecasted&#39;</span><span class="p">,</span> <span class="s1">&#39;Observed&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Obs_active_bins&#39;</span><span class="p">:</span> <span class="n">contingency_df</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
            <span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="n">tau</span><span class="p">,</span>
            <span class="s1">&#39;nu&#39;</span><span class="p">:</span> <span class="n">nu</span><span class="p">,</span>
            <span class="s1">&#39;R_score&#39;</span><span class="p">:</span> <span class="n">R_score</span><span class="p">,</span>

        <span class="p">}</span>
        <span class="n">threshold_row_df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">threshold_row</span><span class="p">])</span>

        <span class="n">Table_molchan</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">Table_molchan</span><span class="p">,</span> <span class="n">threshold_row_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">bottom_row</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Threshold&#39;</span><span class="p">:</span> <span class="s1">&#39;Full alarms&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;nu&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Obs_active_bins&#39;</span><span class="p">:</span> <span class="n">contingency_df</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()}</span>
    <span class="n">top_row</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Threshold&#39;</span><span class="p">:</span> <span class="s1">&#39;No alarms&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;nu&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Obs_active_bins&#39;</span><span class="p">:</span> <span class="n">contingency_df</span><span class="p">[</span><span class="s1">&#39;Observed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()}</span>

    <span class="n">Table_molchan</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">top_row</span><span class="p">]),</span> <span class="n">Table_molchan</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">Table_molchan</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">Table_molchan</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">bottom_row</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Computation of Area Skill score (ASS)</span>
    <span class="n">Tab_as_score</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;Threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Table_molchan</span><span class="p">[</span><span class="s1">&#39;Threshold&#39;</span><span class="p">]</span>
    <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Table_molchan</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]</span>
    <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Table_molchan</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">]</span>

    <span class="n">ONE</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Tab_as_score</span><span class="p">))</span>
    <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;CUM_BAND&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cumulative_trapezoid</span><span class="p">(</span><span class="n">ONE</span><span class="p">,</span> <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">],</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">cumulative_trapezoid</span><span class="p">(</span><span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">],</span>
                                                                                        <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">],</span>
                                                                                        <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;AS_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;CUM_BAND&#39;</span><span class="p">],</span>
                                         <span class="n">cumulative_trapezoid</span><span class="p">(</span><span class="n">ONE</span><span class="p">,</span> <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">],</span> <span class="n">initial</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1e-10</span><span class="p">)</span>
    <span class="n">Tab_as_score</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Tab_as_score</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;AS_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;AS_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ASscore</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">Tab_as_score</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">Tab_as_score</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;AS_score&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nb">bin</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
    <span class="n">devstd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">Table_molchan</span><span class="p">[</span><span class="s1">&#39;Obs_active_bins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">devstd</span> <span class="o">=</span> <span class="n">devstd</span> <span class="o">*</span> <span class="nb">bin</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">devstd</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">devstd</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
    <span class="n">devstd</span> <span class="o">=</span> <span class="n">devstd</span> <span class="o">/</span> <span class="nb">bin</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;st_dev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">devstd</span>
    <span class="n">Tab_as_score</span><span class="p">[</span><span class="s1">&#39;st_dev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">devstd</span>
    <span class="n">dev_std</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">devstd</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Plot the Molchan trajectory</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Table_molchan</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">],</span> <span class="n">Table_molchan</span><span class="p">[</span><span class="s1">&#39;nu&#39;</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">forecast_label</span><span class="si">}</span><span class="s2">, ASS=</span><span class="si">{</span><span class="n">ASscore</span><span class="si">}</span><span class="s2">±</span><span class="si">{</span><span class="n">dev_std</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">forecast_linestyle</span><span class="p">)</span>

    <span class="c1"># Plot uniform forecast</span>
    <span class="k">if</span> <span class="n">plot_uniform</span><span class="p">:</span>
        <span class="n">x_uniform</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
        <span class="n">y_uniform</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.00</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.001</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_uniform</span><span class="p">,</span> <span class="n">y_uniform</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SUP&#39;</span> <span class="o">+</span> <span class="s1">&#39; ASS=0.50&#39;</span><span class="p">)</span>

    <span class="c1"># Plotting arguments</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Miss Rate&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Fraction of area occupied by alarms&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">linear</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">legend_loc</span> <span class="o">=</span> <span class="n">plot_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;legend_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">linear</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">label_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_loc</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">legend_fontsize</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">savepdf</span><span class="p">:</span>
            <span class="n">outFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.pdf&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">savepng</span><span class="p">:</span>
            <span class="n">outFile</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outFile</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_marker_style</span><span class="p">(</span><span class="n">obs_stat</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">one_sided_lower</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns matplotlib marker style as fmt string&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">obs_stat</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">obs_stat</span> <span class="o">&gt;</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># red circle</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;ro&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># green square</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;gs&#39;</span>
    <span class="k">if</span> <span class="n">one_sided_lower</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">obs_stat</span> <span class="o">&lt;</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;ro&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;gs&#39;</span>
    <span class="k">return</span> <span class="n">fmt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_marker_t_color</span><span class="p">(</span><span class="n">distribution</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns matplotlib marker style as fmt string&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span>
    <span class="k">elif</span> <span class="n">distribution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">distribution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;grey&#39;</span>

    <span class="k">return</span> <span class="n">fmt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_marker_w_color</span><span class="p">(</span><span class="n">distribution</span><span class="p">,</span> <span class="n">percentile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns matplotlib marker style as fmt string&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">distribution</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">percentile</span> <span class="o">/</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">fmt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_axis_limits</span><span class="p">(</span><span class="n">pnts</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a tuple of x_min and x_max given points on plot.&quot;&quot;&quot;</span>
    <span class="n">x_min</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">pnts</span><span class="p">)</span>
    <span class="n">xd</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">border</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x_min</span> <span class="o">-</span> <span class="n">xd</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">+</span> <span class="n">xd</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">_get_basemap</span><span class="p">(</span><span class="n">basemap</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">basemap</span> <span class="o">==</span> <span class="s1">&#39;stamen_terrain&#39;</span><span class="p">:</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="n">img_tiles</span><span class="o">.</span><span class="n">Stamen</span><span class="p">(</span><span class="s1">&#39;terrain&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">basemap</span> <span class="o">==</span> <span class="s1">&#39;stamen_terrain-background&#39;</span><span class="p">:</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="n">img_tiles</span><span class="o">.</span><span class="n">Stamen</span><span class="p">(</span><span class="s1">&#39;terrain-background&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">basemap</span> <span class="o">==</span> <span class="s1">&#39;google-satellite&#39;</span><span class="p">:</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="n">img_tiles</span><span class="o">.</span><span class="n">GoogleTiles</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s1">&#39;satellite&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">basemap</span> <span class="o">==</span> <span class="s1">&#39;ESRI_terrain&#39;</span><span class="p">:</span>
        <span class="n">webservice</span> <span class="o">=</span> <span class="s1">&#39;https://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/&#39;</span> \
                     <span class="s1">&#39;MapServer/tile/</span><span class="si">{z}</span><span class="s1">/</span><span class="si">{y}</span><span class="s1">/</span><span class="si">{x}</span><span class="s1">.jpg&#39;</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="n">img_tiles</span><span class="o">.</span><span class="n">GoogleTiles</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">webservice</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">basemap</span> <span class="o">==</span> <span class="s1">&#39;ESRI_imagery&#39;</span><span class="p">:</span>
        <span class="n">webservice</span> <span class="o">=</span> <span class="s1">&#39;https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/&#39;</span> \
                     <span class="s1">&#39;MapServer/tile/</span><span class="si">{z}</span><span class="s1">/</span><span class="si">{y}</span><span class="s1">/</span><span class="si">{x}</span><span class="s1">.jpg&#39;</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="n">img_tiles</span><span class="o">.</span><span class="n">GoogleTiles</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">webservice</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">basemap</span> <span class="o">==</span> <span class="s1">&#39;ESRI_relief&#39;</span><span class="p">:</span>
        <span class="n">webservice</span> <span class="o">=</span> <span class="s1">&#39;https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/&#39;</span> \
                     <span class="s1">&#39;MapServer/tile/</span><span class="si">{z}</span><span class="s1">/</span><span class="si">{y}</span><span class="s1">/</span><span class="si">{x}</span><span class="s1">.jpg&#39;</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="n">img_tiles</span><span class="o">.</span><span class="n">GoogleTiles</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">webservice</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">basemap</span> <span class="o">==</span> <span class="s1">&#39;ESRI_topo&#39;</span><span class="p">:</span>
        <span class="n">webservice</span> <span class="o">=</span> <span class="s1">&#39;https://server.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/&#39;</span> \
                     <span class="s1">&#39;MapServer/tile/</span><span class="si">{z}</span><span class="s1">/</span><span class="si">{y}</span><span class="s1">/</span><span class="si">{x}</span><span class="s1">.jpg&#39;</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="n">img_tiles</span><span class="o">.</span><span class="n">GoogleTiles</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">webservice</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">webservice</span> <span class="o">=</span> <span class="n">basemap</span>
            <span class="n">tiles</span> <span class="o">=</span> <span class="n">img_tiles</span><span class="o">.</span><span class="n">GoogleTiles</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">webservice</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Basemap type not valid or not implemented&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tiles</span>


<div class="viewcode-block" id="add_labels_for_publication">
<a class="viewcode-back" href="../../../reference/generated/csep.utils.plots.add_labels_for_publication.html#csep.utils.plots.add_labels_for_publication">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">add_labels_for_publication</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;bssa&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Adds publication labels too the outside of a figure. &quot;&quot;&quot;</span>
    <span class="n">all_axes</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
    <span class="n">ascii_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">all_axes</span><span class="p">:</span>
        <span class="c1"># check for colorbar and ignore for annotations</span>
        <span class="k">if</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Colorbar&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">annot</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ascii_iter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">style</span> <span class="o">==</span> <span class="s1">&#39;bssa&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">annot</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">1.025</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s1">&#39;axes fraction&#39;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">labelsize</span><span class="p">)</span>

    <span class="k">return</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  
 
&#169; 2020, University of Southern California.
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>